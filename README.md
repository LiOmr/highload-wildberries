## Wildberries: Описание проекта

## 1. Тема и целевая аудитория

Wildberries (также «Ва́йлдберриз») — крупнейший маркетплейс в России, специализирующийся на продаже товаров различных категорий, включая одежду, обувь, бытовую технику и электронику, товары для дома, косметику и многое другое [\[1\]](https://ru.ruwiki.ru/wiki/Wildberries). 

### Продуктовые метрики
- 76,7 млн уникальных посетителей в месяц [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)
- 14 млн уникальных посетителей в день [\[4\]](https://www.retail.ru/news/oborot-wildberries-vyros-na-101-v-iii-kvartale-15-oktyabrya-2021-210183/)
- 41,3 млн активных покупателей в месяц [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)
- Количество активных* селлеров: 293 700 [\[5\]](https://datainsight.ru/sites/default/files/DI_Sellers_monitoring_2024_1_0.pdf?ysclid=m7px4bgk8r609130117)

- Число ежедневных заказов: 8,8 млн [\[7\]](https://mertech.ru/blog/marketpleisy/kak-otkryt-punkt-vydachi-zakazov-wildberries-v-2024/#:~:text=Wildberries%20%E2%80%94%20%D1%81%D0%B0%D0%BC%D1%8B%D0%B9%20%D0%BF%D0%BE%D0%BF%D1%83%D0%BB%D1%8F%D1%80%D0%BD%D1%8B%D0%B9%20%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9,%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D0%B0%D1%8F%20%D0%BE%D1%82%D0%B2%D0%B5%D1%87%D0%B0%D0%B5%D1%82%20%D0%BD%D0%B0%20%D1%87%D0%B0%D1%81%D1%82%D1%8B%D0%B5%20%D0%B2%D0%BE%D0%BF%D1%80%D0%BE%D1%81%D1%8B)

- Среднее число страниц за один визит: 12 [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)
- Среднее время одного визита: 10 мин [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)
- Мобильные устройства: 86% [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)
- Десктоп: 14% [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)

- Среднее число товаров в заказе покупателя: сумма среднего чека / средняя цена одного товара = 1 594 [\[6\]](https://plusworld.ru/articles/62655/#:~:text=%D0%A1%D1%80%D0%B5%D0%B4%D0%BD%D0%B8%D0%B9%20%D1%87%D0%B5%D0%BA%20%D0%BD%D0%B0%20%D0%BC%D0%B0%D1%80%D0%BA%D0%B5%D1%82%D0%BF%D0%BB%D0%B5%D0%B9%D1%81%D0%B0%D1%85%20%D0%B2%D1%8B%D1%80%D0%BE%D1%81,%D0%BE%D0%BD%20%D1%81%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%B8%D0%BB%20793%20%D1%80%D1%83%D0%B1%D0%BB%D1%8F) / 750 = 2,1
- Среднее число товаров на одного селлера: общее количество товарных единиц на Wildberries (SKU) / число активных селлеров = 40 млн [\[9\]](https://workspace.ru/blog/algoritmy-ranzhirovaniya-na-wildberries-kak-oni-rabotayut-i-kak-uluchshit-vidimost-svoih-tovarov/) / 293 700 [\[5\]](https://datainsight.ru/sites/default/files/DI_Sellers_monitoring_2024_1_0.pdf?ysclid=m7px4bgk8r609130117) = 136,2

> *Активные селлеры – селлеры, у которых на момент сбора данных был хотя бы один товар в продаже на маркетплейсе

### Целевая аудитория

**1. Распределение по возрасту** [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)

| Возраст     | Доля  |
|-------------|-------|
| < 18 лет    | 1%    |
| 18–25 лет   | 14%   |
| 26–35 лет   | 35%   |
| 36–45 лет   | 34%   |
| 46–60 лет   | 14%   |
| 60+ лет     | 2%    |

**2. Распределение по полу** [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)

| Пол       | Доля  |
|-----------|-------|
| Женщины   | 66%   |
| Мужчины   | 34%   |

**3. Распределение по уровню дохода** [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)

| Уровень дохода | Доля  |
|----------------|-------|
| Низкий         | 6%    |
| Средний        | 57%   |
| Средний+       | 35%   |
| Высокий        | 2%    |

### Веб-трафик по странам
![image](https://github.com/user-attachments/assets/e15d7d94-e3af-48be-a5a7-2f702621858b) [\[2\]](https://www.similarweb.com/ru/website/wildberries.ru/#overview)

---

### Функционал MVP
**Ключевой функционал** - просмотр ленты товаров

1. Регистрация и авторизация пользователей.  
2. Каталог товаров (возможность добавления и управления товарами – название, описание, цена, фотографии).  
3. Поиск и фильтрация (фильтрация по цене, брендам и другим параметрам).  
4. Корзина и оформление заказа с выбором способа доставки и оплаты.  
5. Онлайн-оплата (минимум один способ онлайн-оплаты, безопасная передача платежных данных).  
6. Доставка (указание адреса доставки/пункта самовывоза, отслеживание статуса заказа).  
7. Личный кабинет покупателя.  
8. Индивидуальные рекомендации товаров на основе:
   - товаров, добавленных в избранное
   - просмотренных пользователем товаров
   - оформленных покупок
   - поисковых запросов
   - региона и геолокации пользователя  
9. Личный кабинет продавца.

---

## 2. Расчет нагрузки

| Характеристика | Значение |
|---------------|----------|
| MAU           | 76,7M    |
| DAU           | 14M      |

---

### 1. Среднее количество действий пользователя в день

| **Действие пользователя**                       | **Количество в день** |
|-------------------------------------------------|-----------------------|
| Просмотр страниц (каталог, карточка товара)     | ~12–13                |
| Поисковые запросы / фильтрация                  | ~2–3                  |
| Добавление в корзину / избранное                | ~1-1,3                |
| Оформление заказа                               | ~0,6                  |
| Прочие действия (личный кабинет, отзывы и т.п.) | 1–2                   |


- **Среднее число просмотренных страниц:** порядка 12 просмотренных товаров в день на одного активного пользователя,[3] Из которых значительная часть – это страницы товаров.
- **Поисковые запросы**: большинство пользователей совершает по 2–3 поисковых/фильтрационных действия за сессию (оценка на основе общей практики e-commerce).
- **Добавления товаров в корзину:** Количество добавлений в корзину примерно в 3 раза превышает число заказов. Это порядка 25–30 млн добавлений в корзину в сутки, или ~1,3 события «Add to cart» на одного пользователя (расчёт: 8,8 млн * 3 / 20 млн ≈ 1,3)
- **Оформление заказа**: по данным [\[7\]](https://mertech.ru/blog/marketpleisy/kak-otkryt-punkt-vydachi-zakazov-wildberries-v-2024/#:~:text=Wildberries%20%E2%80%94%20%D1%81%D0%B0%D0%BC%D1%8B%D0%B9%20%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9), обрабатывается 8,8 млн заказов в сутки. Делим на 14 млн DAU — получается ~0,63 заказа на пользователя в день.
- **Прочие действия**: добавление товаров в избранное, написание отзывов, смена настроек, переход в личный кабинет и т.д.

В сумме выходит **~15–20 действий** на одного пользователя в день.

---

### 2. Средний размер хранилища на одного пользователя

Данные, связанные с одним пользователем (история заказов, содержимое текущей корзины, отзывы, сохраненные товары и пр.) занимают относительно небольшой объём.

| **Тип**                                   | **Примерный объём** |
|-------------------------------------------|---------------------|
| Профиль (учётная запись, настройки)       | ~2–5 КБ             |
| История заказов                           | ~20 КБ              |
| Корзина и избранное                       | <1 КБ (динамически) |
| Отзывы                                    | 0–1 КБ              |

1. **Профиль**: ФИО, телефон, email, адрес(а) доставки, минимальные настройки. Оценочно 2–5 КБ текстовых данных.
2. **История заказов**:
Объём хранения истории заказов = Количество заказов пользователя в год × Средний размер записи о заказе.
   Если 1 заказ/месяц, то за год 12 заказов. При ~1 КБ метаданных на заказ получаем ~12 КБ/год. В среднем ~несколько десятков КБ на «тяжёлого» покупателя.
3. **Корзина и избранное**: хранятся идентификаторы товаров, их количество (обычно несколько товаров, <1 KB).
4. **Отзывы**: в среднем 1 отзыв на 15 заказов​ [8] , каждый отзыв – текст ~0,2–0,5 KB). В сумме получается порядка килобайта на пользователя.

Таким образом, **~50–100 КБ** достаточно для описания одного активного пользователя (вместе со всей историей). При 76,7 млн MAU [\[3\]](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf) общий объём может достигать нескольких терабайт.

---

### 3. Технические метрики

| **Тип данных**                      | **Расчёт объёма данных**                                     | **Объём хранения (TB)** |
|------------------------------------|--------------------------------------------------------------|-------------------------|
| **Каталог товаров (SKU)**          | 40 млн × 2 KB = 80 млн KB                                    | ≈ 0,08 TB              |
| **Изображения товаров**            | 40 млн × 5 изображений × 0,2 MB = 40 млн MB                  | ≈ 38 TB                |
| **История заказов (5 лет)**        | ~16 млрд × 1 KB = 16 млрд KB                                 | ≈ 16 TB                |
| **Отзывы пользователей**           | ~1 млрд × 0,5 KB = 0,5 млрд KB                               | ≈ 0,5 TB               |
| **Прочие данные (профили, справочники и др.)** | 76,7 млн × 1 KB = 76,7 млн KB                                | ≈ 0,07 TB              |

- **Каталог товаров (SKU):** При 40 млн товарных позиций со средним размером записи 2 KB общий объем данных составляет 40 000 000 × 2 KB ≈ 80 000 000 KB, что эквивалентно примерно 0,08 TB хранения.
- **Изображения товаров:** Для ~40 млн товаров, у каждого в среднем по 5 изображений размером ~0,2 MB, суммарный объем изображений оценивается как 40 000 000 × 5 × 0,2 MB ≈ 40 000 000 MB. Это соответствует приблизительно 38 TB (так как 1 TB ≈ 1 048 576 MB в двоичной системе).
- **История заказов:** Поступление ~8,8 млн заказов в день приводит к ~16 млрд записей за 5 лет. При среднем размере 1 KB на запись общая история заказов займет около 16 000 000 000 × 1 KB = 16 000 000 000 KB, что примерно равно 16 TB.
- **Отзывы пользователей:** Поскольку в среднем приходится 1 отзыв на 15 заказов, за 5 лет набирается порядка 1 млрд отзывов. При среднем размере отзыва ~0,5 KB суммарный объем данных отзывов будет ≈ 1 000 000 000 × 0,5 KB = 500 000 000 KB, то есть около 0,5 TB (примерно полтерабайта).
- **Прочие данные:** В эту категорию входят профили ~76,7 млн пользователей, справочники и др. При среднем размере записи ~1 KB общий объем составляет 76 700 000 × 1 KB = 76 700 000 KB, что порядка 0,07 TB хранения, данные профиля ~1 KB => ~0,07 TB; данные о продавцах (~1 млн продавцов) и категории – еще несколько GB. В сумме незначительно относительно прочего. 
---

### 4. Сетевой трафик

| **Действие**                                     | **Трафик на действие** | **Среднее потребление (Гбит/с)** | **Пиковое потребление (Гбит/с)** | **Суммарный суточный трафик (ГБ/сутки)**                                                                                                                                     |
|--------------------------------------------------|------------------------|----------------------------------|----------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Просмотр каталога / карточки товара**          | ~2 МБ                 | ~25–30                           | ~60–70                           | **344 000**<br/>Расчёт: 168 млн просмотров в сутки × 2 МБ = 336 000 000 МБ = 336 000 МБ ~ 336 ТБ → в ГБ: 336 000 × 1024 ≈ 344 064 ГБ                                                                                    |
| **Поиск / фильтрация**                           | ~50–100 КБ            | ~2–3                             | ~5–6                              | **350–700**<br/>Зависит от количества запросов: при 5–10 млн запросов в сутки и среднем 75 КБ на ответ, получается ~0,35–0,7 ТБ (350–700 ГБ)                                                                          |
| **Оформление заказа**                            | ~100–200 КБ           | ~1–2                             | ~3–4                              | **800–1 600**<br/>8,8 млн заказов в сутки, в среднем 150 КБ на заказ: 8,8 млн × 150 КБ ≈ 1,3×10^9 КБ ~ 1,2–1,6 ТБ (800–1 600 ГБ)                                                                                       |
| **Добавление в корзину / избранное (AJAX)**      | ~10–50 КБ             | <1                                | ~1–2                              | **200–400**<br/>Приблизительно 0,5–1 операции на пользователя (14 млн DAU). Например, 7–14 млн добавлений × 30 КБ = 210–420 млн КБ ~ 200–400 ГБ в сутки                                                                |
---

Пояснения к расчётам:

1. **Просмотр каталога/карточки**  
   - *168 млн просмотров/день* (12 страниц × 14 млн DAU).  
   - *Средний вес страницы ~2 МБ* (HTML + JS/CSS + изображения).  
   - Итого: 168 000 000 × 2 МБ = 336 000 000 МБ = 336 000 МБ = 336 000 ТБ/1024 ≈ 344 064 ГБ.  
   - В таблице округлено до 344 000 ГБ.

2. **Поиск / фильтрация**  
   - Средний ответ: 50–100 КБ (список товаров, краткая информация).  
   - Количество поисковых запросов сильно варьируется; при 5–10 млн запросов/сутки получается ориентировочно 350–700 ГБ.

3. **Оформление заказа**  
   - ~8,8 млн заказов/день × 100–200 КБ на процесс (данные о товаре, подтверждение, оплата) = ~0,8–1,6 ТБ в сутки (800–1600 ГБ).  

4. **Добавление в корзину / избранное**  
   - ~10–50 КБ на одно добавление (AJAX-запрос). При ~7–14 млн таких операций в сутки общий трафик 200–400 ГБ.

### 5. RPS (Requests per Second)

| **Тип запроса**                     | **Средний RPS** | **Пиковый RPS** |
|-------------------------------------|-----------------|-----------------|
| Просмотр каталога / карточек товара | ~1 900–2 000    | ~4 000–6 000    |
| Поиск / фильтрация                  | ~500–1 000      | ~2 000–3 000    |
| Оформление заказа                   | ~100            | ~300            |
| Добавление в корзину / избранное    | ~300–500        | ~1 000          |
| **Итого (примерно)**                | ~2 800–3 600    | ~7 000–10 000   |


1. **Просмотр каталога / карточек товара**  
   - В среднем 14 млн DAU (активных пользователей в день). Каждый просматривает ~12 страниц.  
   - Итого в сутки: 14 млн × 12 = 168 млн просмотров.  
   - Делим на количество секунд в сутках (86 400):  
     ```
     168 000 000 / 86 400 ≈ 1 945 RPS
     ```
   - Для удобства округляем до 1 900–2 000 в таблице. Пиковое значение обычно в 2–3 раза выше.

2. **Поиск / фильтрация**  
   - Допустим, 30–60% пользователей делают несколько поисковых запросов. Например, если взять 5 млн – 10 млн поисковых действий за сутки.  
   - 5 000 000 / 86 400 ≈ 58 RPS, 10 000 000 / 86 400 ≈ 116 RPS. Но при учёте, что часть пользователей может делать 2–3 поисковых запроса, итоговая нагрузка может вырасти до ~500 RPS.  
   - Также бывают всплески в часы пик или распродажи, когда поисковая активность кратно увеличивается. Поэтому берём диапазон 500–1 000 RPS. Пиковое 2 000–3 000.

3. **Оформление заказа**  
   - В сутки: 8,8 млн заказов (по данным маркетплейса).  
   - Делим: 8 800 000 / 86 400 ≈ 102 RPS.  
   - С учётом округлений и неравномерной активности в разное время суток указываем ~100 RPS в среднем, и 2–3 кратное увеличение в пике.

4. **Добавление в корзину / избранное**  
   - Предположим, в день ~70% DAU делает 1–2 добавления: это 14 млн × 0,7 × (в среднем ~1,5 добавления) = ~14,7 млн действий.  
   - 14 700 000 / 86 400 ≈ 170 RPS. Но может быть выше за счёт «серфинга» (многие добавляют несколько товаров).  
   - Усреднённо указываем 300–500. Пиковое в 2–3 раза больше.

5. **Итого (примерно)**  
   - Складываем разные типы операций: 1 900–2 000 (просмотры) + 500–1 000 (поиск) + 100 (заказы) + 300–500 (корзина) ≈ 2 800–3 600 RPS.  
   - В период распродаж суммарная пиковая нагрузка может дойти до 7 000–10 000 RPS. В отдельных сервисах (например, поиск) бывают кратковременные всплески до сотен тысяч RPS, когда начинается массовый заход пользователей.


**Среднее количество запросов в секунду (RPS) рассчитывается по формуле:**  
> _RPS (Requests Per Second) = Общее количество операций в сутки / Количество секунд в сутках (86 400)._  



## 3. Глобальная балансировка нагрузки

### Функциональное разбиение по доменам

- **wildberries.ru** — API-сервисы для мобильных приложений и веб-версии.  
- **cdn.wildberries.ru** — доставка медиа-контента (фото товаров, видео, баннеры).  
- **wbxoofex.wildberries.ru** — сервис оформления заказов и управления корзиной.  
- **search.wb.ru** — отдельный домен для поиска товаров.  
- **seller.wildberries.ru** — платформа для продавцов.

---

### Расположение ДЦ

Wildberries использует централизованную архитектуру с одним дата-центром, расположенным в Москве. Это решение обеспечивает:

- Низкие задержки для основной аудитории (европейская часть России).
- Упрощение инфраструктуры и обслуживания.
- Централизацию бизнес-логики и хранения данных.

Для обеспечения отказоустойчивости в условиях единого ЦОД:

- Внутри московского дата-центра развернуты кластеры всех ключевых сервисов с горизонтальным масштабированием.
- Статические ресурсы (изображения, JS/CSS) кэшируются через CDN (расположенные ближе к пользователям).
- Критические данные регулярно бэкапятся в облако.

---

### Расчет распределения запросов

Поскольку используется только один дата-центр, весь трафик обрабатывается централизованно. Однако внутри дата-центра нагрузка распределяется по сервисам и их инстансам. Основные типы запросов:

1. **Просмотр каталога/карточек товара** — максимальный объем трафика.
2. **Поиск и фильтрация** — чувствительные к задержкам.
3. **Добавление в корзину/избранное** — частые AJAX-запросы.
4. **Оформление заказа** — критично к отказам и консистентности.

---

#### Таблица распределения RPS в централизованной архитектуре

| Тип запроса                | Средний RPS (общий) | Обработка (Москва, 100%) |
|----------------------------|---------------------|---------------------------|
| **Просмотр каталога**       | 1,900–2,000         | 1,900–2,000               |
| **Поиск/фильтрация**        | 500–1,000           | 500–1,000                 |
| **Оформление заказа**       | ~100                | ~100                      |
| **Добавление в корзину**    | 300–500             | 300–500                   |
| **Итого RPS**               | **2,800–3,600**     | **2,800–3,600**           |

---

1. **Просмотр каталога и поиск**:
   - Основная нагрузка на фронтенд и API-сервисы.
   - Раздается часть через CDN, остальное — из серверов приложений внутри московского дата-центра.

2. **Оформление заказов**:
   - Обрабатываются централизованно с высокой надежностью.
   - Данные синхронно записываются в отказоустойчивую кластерную БД.

3. **Добавление в корзину/избранное**:
   - Часто используемые запросы с минимальной нагрузкой на сеть и БД.
   - Быстро обрабатываются через API и in-memory кэш.

---

### Схема балансировки

При централизованной архитектуре балансировка реализуется внутри одного дата-центра в Москве с использованием нескольких уровней:

1. **DNS-резолвинг**:
   - Все домены `*.wildberries.ru` резолвятся на IP московского ЦОД.
   - Отказоустойчивость DNS реализована через кластер публичных DNS-серверов с коротким TTL (60–300 сек).

2. **Балансировка уровня L4 и L7**:
   - Входящий трафик поступает на кластер балансировщиков (например, HAProxy или NGINX Ingress).
   - Балансировщики направляют трафик на нужные микросервисы, согласно правилам маршрутизации (по URI, хосту, порту и т. д.).

3. **Кластеризация сервисов**:
   - Все сервисы масштабируются горизонтально.
   - Поддержка автоматического масштабирования при увеличении нагрузки (например, через Kubernetes HPA).
   - Кеширующие слои (Redis, Memcached) используются для снижения нагрузки на БД.

4. **CDN для статики**:
   - Изображения, видео и баннеры отдаются через CDN.
   - Это минимизирует нагрузку на ЦОД и ускоряет отдачу данных для пользователей из регионов.




## 4. Локальная балансировка нагрузки

### Описание архитектуры

В централизованной архитектуре Wildberries весь трафик обрабатывается в одном дата-центре в Москве. Входящие HTTPS-запросы поступают на кластер **L7-балансировщиков (Reverse Proxy)**, которые:

- завершают SSL/TLS-соединение (SSL termination),
- маршрутизируют запросы на микросервисы по URI/заголовкам (например, `/search`, `/cart`),
- кэшируют статический и полу-динамический контент,
- обеспечивают сжатие ответов и защиту от перегрузок (rate limiting, circuit breakers).

Балансировка осуществляется на уровне приложений (L7), что позволяет гибко управлять трафиком и равномерно распределять нагрузку между сервисами.

---

### Обоснование выбора балансировщика

Для Wildberries рассматриваются два варианта: **NGINX Open Source** и **NGINX Plus**.

**NGINX Open Source** — бесплатен, стабилен, высокопроизводителен. Однако не поддерживает активные health-check'и, динамическое управление конфигурацией и встроенный мониторинг.

**NGINX Plus** — коммерческая версия, обладающая:
- поддержкой от вендора (F5),
- встроенными метриками и дашбордом,
- session persistence и API для динамической настройки,
- активными health-check'ами.

Согласно [тесту производительности NGINX](https://blog.nginx.org/) [11], **одно CPU-ядро может обрабатывать до ~28 000 новых HTTPS-запросов в секунду** в пессимистичном сценарии (без reuse соединений). На практике это даёт запас прочности и гибкость масштабирования. С учётом масштабов Wildberries и критичности к бесперебойной работе, **выбор в пользу NGINX Plus оправдан**: он позволяет снизить операционные риски и упростить сопровождение кластера.

---

### Расчёт нагрузки и CPU

#### Исходные данные:
- Пиковый RPS: **10 000**
- Размер запроса: ~10 КБ
- Предположения: каждый запрос — новое соединение, нет reuse
- Производительность по [11]:  
  - **NGINX OSS**: ~700 HTTPS-соединений/с на 1 ядро  
  - **NGINX Plus**: ~800 HTTPS-соединений/с на 1 ядро

---

#### Таблица расчета CPU и трафика

| Балансировщик     | RPS     | Трафик (Мбит/с) | CPU, мс/с | Необходимые ядра |
|-------------------|---------|------------------|------------|-------------------|
| **NGINX OSS**     | 10 000  | ~800             | ~14 300     | ~15–16 ядер       |
| **NGINX Plus**    | 10 000  | ~800             | ~12 500     | ~13–14 ядер       |

> Пример: 1 ядро = 1 000 мс CPU/сек.  
> С учетом резерва и возможности масштабирования на практике используют 2+ балансировщика (Active/Active или Active/Passive) по 8–16 vCPU каждый.

---

### Применение в Wildberries

- **Просмотр каталога**: кэширование изображений и статики снижает нагрузку.
- **Поиск/фильтрация**: направляется на отдельный кластер поиска.
- **Оформление заказа**: прокси проверяет доступность бэкендов (CRM, платежи) и переключается при сбое.
- **Рекомендации и авторизация**: маршрутизация по cookie или URI на нужный сервис.

---

Для централизованной архитектуры с пиковым RPS до 10 000, Wildberries использует **L7-балансировку через NGINX Plus**, как более надёжное, управляемое и масштабируемое решение. Балансировка выполняет не только распределение трафика, но и SSL termination, кэширование и управление отказоустойчивостью сервисов. Это снижает задержки, увеличивает стабильность и упрощает эксплуатацию всей платформы.


## 5. Логическая схема БД
https://dbdiagram.io/d/DB-67d834af75d75cc844632f37

![DB](https://github.com/user-attachments/assets/650f27fb-de5f-47cf-ab38-371a2d556678)


---

### 1. Описанием таблиц и основных полей

| **Название таблицы**     | **Назначение**                                                                                                                                                | **Основные поля**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | **Связи**                                                                                                                                                           |
|--------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **users**                | Хранение информации о пользователях (как покупателях, так и продавцах, администраторах и т.д.).                                                              | - **id** (PK) – уникальный идентификатор<br>- **name** – имя пользователя<br>- **email** – адрес электронной почты<br>- **password** – пароль (хранить в виде хеша)<br>- **user_type** – тип пользователя (buyer, seller, admin)<br>- **region**, **geolocation** – локационные данные для персонализации и доставки<br>- **created_at**, **updated_at** – даты создания и обновления записи                                                                                | - Связь «1 ко многим» с таблицей **products** (seller_id → users.id)<br>- Связь «1 ко многим» с **carts** (user_id → users.id)<br>- Связь «1 ко многим» с **orders** (user_id → users.id)                   |
| **products**             | Каталог товаров, включая название, описание, цену, привязку к продавцу и т.д.                                                                                 | - **id** (PK) – уникальный идентификатор<br>- **seller_id** (FK на **users**.id) – продавец<br>- **name** – название<br>- **description** – описание<br>- **price** – цена<br>- **brand** – бренд (для фильтрации)<br>- **image_url** – ссылка на изображение (или несколько полей/таблиц для хранения мультимедиа)<br>- **created_at**, **updated_at** – даты создания и обновления                                                                                                      | - Связь «многие к одному» с **users** (seller_id)<br>- Связь «многие ко многим» с **categories** через **product_categories**<br>- Связь «1 ко многим» с **views** (product_id) |
| **categories**           | Справочник категорий товаров (дерево категорий или плоский список).                                                                                           | - **id** (PK) – уникальный идентификатор<br>- **name** – наименование категории<br>- **parent_id** (FK на **categories**.id) – для иерархической структуры категорий (при необходимости)                                                                                                                                                                                                                                                                                                      | - Связь «многие к одному» саму с собой (parent_id → categories.id)<br>- Через **product_categories** связывается с **products**                                                                           |
| **product_categories**   | Таблица-связка «многие ко многим» между товарами и категориями.                                                                                              | - **product_id** (FK на **products**.id)<br>- **category_id** (FK на **categories**.id)<br>- PK по паре (product_id, category_id)                                                                                                                                                                                                                                                                                                                                                              | - Связь «многие ко многим» между **products** и **categories**                                                                                                       |
| **favorites**            | Хранение «избранного» для каждого покупателя (список товаров, которые пользователь добавил в избранное).                                                     | - **user_id** (FK на **users**.id)<br>- **product_id** (FK на **products**.id)<br>- **created_at**<br>- PK по паре (user_id, product_id)                                                                                                                                                                                                                                                                                                                                                       | - Связь «многие ко многим» (через отдельную таблицу) между **users** и **products**, но в данном случае PK = (user_id, product_id)                                                                         |
| **views**                | Учет просмотренных товаров пользователем (для рекомендаций и аналитики).                                                                                     | - **id** (PK) – уникальный идентификатор<br>- **user_id** (FK на **users**.id)<br>- **product_id** (FK на **products**.id)<br>- **viewed_at** – дата/время просмотра                                                                                                                                                                                                                                                                                                                           | - Связь «многие ко многим» (фактически через дополнительную информацию) между **users** и **products**, но реализуется как «1 ко многим» для каждой из сторон         |
| **search_queries**       | Хранение истории поисковых запросов пользователей (для рекомендаций и анализа популярности товаров).                                                          | - **id** (PK) – уникальный идентификатор<br>- **user_id** (FK на **users**.id)<br>- **query** – текст поискового запроса<br>- **created_at** – дата/время запроса                                                                                                                                                                                                                                                                                                                             | - Связь «многие ко многим» (через дополнительную информацию) между **users** и поисковым контентом (сам запрос)                                                      |
| **carts**                | Корзина товаров для каждого пользователя (активная корзина до оформления заказа).                                                                             | - **id** (PK) – уникальный идентификатор<br>- **user_id** (FK на **users**.id)<br>- **created_at**, **updated_at**                                                                                                                                                                                                                                                                                                                                                                            | - Связь «1 ко многим» (user_id → users.id)<br>- Связь «1 ко многим» с **cart_items**                                                                                |
| **cart_items**           | Содержимое корзины (товары и их количество).                                                                                                                  | - **id** (PK) – уникальный идентификатор<br>- **cart_id** (FK на **carts**.id)<br>- **product_id** (FK на **products**.id)<br>- **quantity**<br>- **created_at**, **updated_at**                                                                                                                                                                                                                                                                                                             | - Связь «многие к одному» с **carts** и **products**                                                                                                                |
| **orders**               | Оформленные заказы пользователей.                                                                                                                             | - **id** (PK) – уникальный идентификатор<br>- **user_id** (FK на **users**.id)<br>- **order_date**<br>- **status** – статус заказа (напр. «Новый», «Оплачен», «Доставляется», «Завершен», «Отменен») <br>- **payment_method**<br>- **shipping_method**<br>- **shipping_address**, **shipping_city**, **shipping_region**, **shipping_postal_code**<br>- **total_amount**<br>- **created_at**, **updated_at**                                                                                                           | - Связь «1 ко многим» (user_id → users.id)<br>- Связь «1 ко многим» с **order_items** (order_id → orders.id)<br>- Связь «1 к 1» или «1 ко многим» с **payments** и **shipment_tracking**                    |
| **order_items**          | Перечень товаров в заказе (в т.ч. количество и цена на момент оформления).                                                                                   | - **id** (PK) – уникальный идентификатор<br>- **order_id** (FK на **orders**.id)<br>- **product_id** (FK на **products**.id)<br>- **quantity**<br>- **unit_price**, **total_price**<br>- **created_at**, **updated_at**                                                                                                                                                                                                                                                                       | - Связь «многие к одному» (order_id → orders.id), (product_id → products.id)                                                                                        |
| **payments**             | Информация об оплатах (для одного заказа может быть несколько платежей или один платеж).                                                                     | - **id** (PK) – уникальный идентификатор<br>- **order_id** (FK на **orders**.id)<br>- **amount**<br>- **payment_date**<br>- **status** (напр. «Проведён», «Отклонён», «В обработке»)<br>- **payment_method** – какой сервис/метод оплаты<br>- **transaction_id**<br>- **created_at**, **updated_at**                                                                                                                                                                                        | - Связь «многие к одному» (order_id → orders.id)                                                                                                                    |
| **shipment_tracking**    | Данные для отслеживания доставки (трек-номер и статус посылки).                                                                                              | - **id** (PK) – уникальный идентификатор<br>- **order_id** (FK на **orders**.id)<br>- **tracking_number**<br>- **status**<br>- **updated_at**                                                                                                                                                                                                                                                                                                                                                 | - Связь «1 ко многим» (order_id → orders.id)                                                                                                                       |


# Размер таблиц и объём данных


| Таблица           | Размер строки (байт) | Пояснение                                                                                 | Кол-во строк (оценка)      | Общий размер таблицы  |
|-------------------|----------------------|-------------------------------------------------------------------------------------------|---------------------------:|-----------------------|
| **Users** (пользователи)       | ~150              | `user_id` (INT, 4 байта), имя (VARCHAR, ~30 байт), email/телефон (VARCHAR, ~30 байт), хэш пароля (VARCHAR, ~60 байт), дата регистрации (TIMESTAMP, 8 байт). Примерно 130 байт данных + запас на служебные поля/выравнивание. | ~76 700 000  (≈76,7 млн MAU)  | ~11 000 МБ (≈11 ГБ)    |
| **Products** (товары/SKU)     | ~250              | `product_id` (INT, 4 байта), название товара (VARCHAR, ~50 байт), категория (SMALLINT, 2 байта), продавец (INT, 4 байта), цена (DECIMAL/FLOAT, 8 байт), описание (TEXT, ~200 байт среднее). Около 268 байт на запись, округлено. | ~40 000 000               | ~10 000 МБ (≈10 ГБ)    |
| **Categories** (категории)    | ~50               | `category_id` (SMALLINT, 2 байта), название категории (VARCHAR, ~20 байт), родительская категория (SMALLINT, 2 байта). Небольшой набор полей для иерархии каталога. | ~5 000                    | <0.01 ГБ (≈0.003 ГБ)   |
| **Carts** (корзины)          | ~16               | `cart_id` (INT, 4 байта, соответствует пользователю), дата обновления (TIMESTAMP, 8 байт). Хранит текущую активную корзину каждого пользователя. | ~80 000 000               | ~1 200 МБ (≈1.2 ГБ)    |
| **Cart_items** (позиции в корзинах) | ~16       | `cart_id` (INT, 4 байта), `product_id` (INT, 4 байта), количество (INT, 4 байта). Каждая запись представляет товар в корзине и его количество. | ~100 000 000              | ~1 600 МБ (≈1.6 ГБ)    |
| **Orders** (заказы)         | ~50               | `order_id` (BIGINT, 8 байт), `user_id` (INT, 4 байта), дата заказа (TIMESTAMP, 8 байт), статус (TINYINT, 1 байт), сумма итого (DECIMAL, 8 байт). Минимальный набор данных по заказу (адрес доставки хранится отдельно). | ~3 200 000 000 (≈3,2 млрд) | ~160 000 МБ (≈160 ГБ)  |
| **Order_items** (товары в заказах) | ~24       | `order_id` (BIGINT, 8 байт), `product_id` (INT, 4 байта), количество (INT, 4 байта), цена товара (DECIMAL, 8 байт). Строка на каждый товар, проданный в рамках заказа. | ~6 400 000 000 (≈6,4 млрд) | ~300 000 МБ (≈300 ГБ)  |
| **Payments** (платежи)       | ~32               | `payment_id` (BIGINT, 8 байт), `order_id` (BIGINT, 8 байт), метод оплаты (TINYINT, 1 байт), статус оплаты (TINYINT, 1 байт), сумма (DECIMAL, 8 байт), транзакция/квитанция (VARCHAR, ~20 байт). | ~3 200 000 000 (≈3,2 млрд) | ~100 000 МБ (≈100 ГБ)  |
| **Shipment_tracking** (отгрузки) | ~40        | `order_id` (BIGINT, 8 байт), трек-номер посылки (VARCHAR, ~20 байт), статус доставки (TINYINT, 1 байт), последний апдейт/дата доставки (TIMESTAMP, 8 байт). | ~3 200 000 000 (≈3,2 млрд) | ~130 000 МБ (≈130 ГБ)  |

*Примечание:* Оценочное число строк для таблиц **Orders**, **Order_items**, **Payments** и **Shipment_tracking** рассчитывалось исходя из ~8,8 млн заказов в день. Это соответствует приблизительно 3,2 млрд заказов в год, которые хранятся в базе (без учёта архивирования старых данных). **Order_items** предположительно в ~2 раза больше количества заказов, исходя из среднего ~2 товаров на заказ. Для **Payments** и **Shipment_tracking** считается по одному записанному платежу и отправлению на каждый заказ (в реальности возможно более одного отправления на заказ, но для упрощения принят 1:1). 

Таблица **Users** основана на показателе ~76,7 млн уникальных активных пользователей в месяц (MAU), что задаёт порядок величины зарегистрированных аккаунтов. **Products** отражает ассортимент ~40 млн SKU (уникальных товаров/предложений) на площадке. **Categories** включает несколько тысяч категорий и подкатегорий товаров – объём этой таблицы незначителен по сравнению с другими. 

В **Carts** хранится по одной актуальной корзине на пользователя; мы предполагаем порядка десятков миллионов активных корзин. **Cart_items** содержит записи товаров, добавленных в корзины; оценка (~100 млн строк) основана на допущении, что не все пользователи имеют наполненную корзину одновременно (в среднем 1–2 товара в активной корзине пользователя). 

Размер одной строки в каждой таблице рассчитан по типам полей: числовые идентификаторы (INT, BIGINT) занимают 4–8 байт, UUID при использовании занял бы 16 байт на значение, короткие числовые статусы – 1 байт, даты/время – 8 байт, строки переменной длины (VARCHAR/TEXT) оценивались по средней длине в байтах. Общий объём таблиц в основном определяется количеством записей: например, таблицы заказов и связанных с ними данных достигают масштаба сотен гигабайт, тогда как справочные таблицы (категории и т.п.) занимают незначительное пространство.


### Размеры данных и нагрузки на чтение/запись

Ниже приведена **сводная таблица** по нагрузке на чтение и запись (RPS — запросы в секунду) для каждой ключевой таблицы, исходя из общего распределения действий пользователей (просмотры, поиск, оформление заказов, добавление в корзину и т.д.). 


---

## Размеры данных и нагрузки на чтение/запись

В таблице:

1. **Row Size (bytes)** – усреднённый размер одной строки (включая типичные поля).  
2. **Read RPS / Write RPS** – приблизительный диапазон запросов в секунду.  
3. **Rows per read / write** – сколько строк в среднем участвует в одном запросе.  
4. **Rows read/s или write/s** = (RPS × Rows per req).  
5. **Data read/s (bytes/s)** = (Rows read/s) × (Row Size). 


| **Таблица**          | **Row<br>Size (bytes)** | **Read<br>RPS**       | **Rows<br>per read** | **Rows<br>read/s**               | **Data<br>read/s (bytes/s)**                        | **Write<br>RPS**  | **Rows<br>per write** | **Rows<br>write/s**             | **Data<br>write/s (bytes/s)**                     | **Комментарий**                                                                                                        |
|----------------------|:-----------------------:|:---------------------:|:--------------------:|:--------------------------------:|:----------------------------------------------------:|:-----------------:|:---------------------:|:--------------------------------:|:--------------------------------------------------:|:-----------------------------------------------------------------------------------------------------------------------|
| **users**            | ~1 024                 | 50–100               | 1                   | 50–100                            | 50–100 × 1 024 ≈ 51 200–102 400 <br>(≈ 50–100 KB/s)   | 2–5               | 1                     | 2–5                               | 2–5 × 1 024 ≈ 2 048–5 120 <br>(≈ 2–5 KB/s)         | Чтение при авторизации, просмотре профиля; запись реже (регистрация, обновление)                                         |
| **products**         | ~2 048                 | 1 500–2 000          | ~10                 | 15 000–20 000                     | 15 000–20 000 × 2 048 <br>≈ 30,7–41 млн байт/с <br>(≈ 30–40 MB/s) | 50–80            | 1                     | 50–80                            | 50–80 × 2 048 = 102 400–163 840 <br>(≈ 0,1–0,16 MB/s) | Наиболее часто читаемая таблица (каталог товаров). Часть отдаётся из кэша (Redis, CDN), что уменьшает реальную нагрузку    |
| **categories**       | ~512                   | 300–500              | ~20                 | 6 000–10 000                      | 6 000–10 000 × 512 <br>≈ 3 072 000–5 120 000 <br>(≈ 3–5 MB/s)      | 1–2              | 1                     | 1–2                              | 512–1 024 <br>(~0,5–1 KB/s)                      | Чтение для структуры категорий. Запись редка (админ добавляет/правит категории)                                           |
| **product_categories** | ~307                 | 300–500              | ~30                 | 9 000–15 000                      | 9 000–15 000 × 307 ≈ 2 763 000–4 605 000 <br>(≈ 2,7–4,6 MB/s)       | 10–20            | ~2                    | 20–40                           | 20–40 × 307 ≈ 6 140–12 280 <br>(6–12 KB/s)         | Связка «товар–категория». Активно читается при фильтрации/поиске                                                           |
| **favorites**        | ~307                  | 100–200             | 1                   | 100–200                           | 30 700–61 400 <br>(30–60 KB/s)                       | 50–100           | 1                     | 50–100                           | 15 350–30 700 <br>(15–30 KB/s)                    | Пользовательские избранные товары. «Добавить/удалить из избранного»                                                       |
| **views**            | ~512                  | 10–50               | ~10                 | 100–500                           | 100–500 × 512 = 51 200–256 000 <br>(≈ 0,05–0,25 MB/s) | 400–600          | 1                     | 400–600                          | 400–600 × 512 = 204 800–307 200 <br>(≈ 0,2–0,3 MB/s) | Лог просмотров (высокий объём записи). В реальности часто уходит во внешнее аналитическое хранилище (ClickHouse и т.д.)     |
| **search_queries**   | ~512                  | 5–10                | 1                   | 5–10                              | 2 560–5 120 <br>(≈ 2,5–5 KB/s)                      | 100–200          | 1                     | 100–200                          | 51 200–102 400 <br>(≈ 50–100 KB/s)                | Лог поисковых запросов (высокий write, редко читают онлайн). Обычно анализируют отдельно                                    |
| **carts**            | ~512                  | 200–300             | 1                   | 200–300                           | 102 400–153 600 <br>(≈ 0,1–0,15 MB/s)                | 150–200          | 1                     | 150–200                          | 76 800–102 400 <br>(≈ 0,07–0,1 MB/s)              | Описание корзины (ID, пользователь, таймстемп). «cart_items» хранит детали товаров                                         |
| **cart_items**       | ~512                  | 200–300             | ~5                  | 1 000–1 500                       | 512 000–768 000 <br>(≈ 0,5–0,75 MB/s)                | 150–200          | 1                     | 150–200                          | 76 800–102 400 <br>(≈ 0,07–0,1 MB/s)              | Позиции в корзине: при чтении часто выбирают сразу несколько строк                                                         |
| **orders**           | ~1 024               | 50–100             | ~3                  | 150–300                           | 153 600–307 200 <br>(≈ 0,15–0,3 MB/s)                | ~100             | 1                     | ~100                             | 100 × 1 024 = 102 400 <br>(≈ 0,1 MB/s)            | Запись при создании нового заказа; чтение при просмотре истории                                                             |
| **order_items**      | ~512                  | 50–100             | ~5                  | 250–500                           | 128 000–256 000 <br>(≈ 0,12–0,25 MB/s)               | ~100             | ~3                    | 300                              | 300 × 512 = 153 600 <br>(≈ 0,15 MB/s)             | В одном заказе обычно несколько позиций                                                                                    |
| **payments**         | ~512                  | 20–30              | 1                   | 20–30                             | 10 240–15 360 <br>(≈ 0,01–0,015 MB/s)                | 50–80            | 1                     | 50–80                            | 25 600–40 960 <br>(≈ 0,025–0,04 MB/s)             | Фиксация платежа и проверка статуса                                                                                        |
| **shipment_tracking**| ~512                  | 20–30              | 1                   | 20–30                             | 10 240–15 360 <br>(≈ 0,01–0,015 MB/s)                | 10–20            | 1                     | 10–20                            | 5 120–10 240 <br>(≈ 0,005–0,01 MB/s)             | Отслеживание посылок: в основном чтение; запись статусов реже                                                               |

---

- При **суммарном RPS** (просмотры, корзина, поиск, оформление и т.д.) ~2 800–3 600 в среднем (и до 7 000–10 000 в пике) **далеко не все** запросы доходят до каждой таблицы.  
- Часть запросов — кэшированные данные (CDN статика, redis-cache и т.д.), часть — вообще не идут в SQL-базу.
- Поэтому реальные RPS на каждую таблицу оказываются ниже, чем суммарный RPS на уровень веб-сервиса.


### Требования к консистентности

1. **ACID-транзакции**  
   - Для оформления заказов, списания платежей и т.д. необходима полная гарантия целостности (Atomicity, Consistency, Isolation, Durability).  

---

### Особенности распределения нагрузки по ключам

При масштабировании и большом объёме данных возникают вопросы **шардирования** и **репликации**:

- **Горизонтальное шардирование по пользователям (user_id)**  
  - Таблицы, сильно зависящие от пользователя: `carts`, `views`, `search_queries`, `favorites` и др., можно партиционировать или шардировать по `user_id`.  
  - Это распределяет нагрузку на чтение/запись по нескольким узлам, так как запросы, связанные с одним пользователем, будут попадать на конкретный шард.

- **Партиционирование по дате**  
  - Для «логов» (например, `views`, `search_queries`) часто используют **партиционирование по времени** (партиции по месяцам/неделям). Устаревшие данные можно либо архивировать, либо хранить в менее дорогом хранилище.  

- **Репликация**  
  - Для повышения отказоустойчивости и скорости чтения (особенно запросов, связанных с просмотром каталога, поиском товаров и т.п.) используют реплики. Основной узел (Primary) отвечает за запись, а чтение масштабируется за счёт Replica-нод.

### 6. Физическая схема БД

### 6.1. Схема БД
https://dbdiagram.io/d/DB-67d834af75d75cc844632f37
![DB2](https://github.com/user-attachments/assets/67d8902e-5a5c-458f-ab02-c2c8363f6565)



![image](https://github.com/user-attachments/assets/4f10bb00-c146-4f4d-ad87-03f9751ae059)


## 6.2. Пояснения

### 6.2.1. Таблица с описанием (структурой) основных таблиц

| **Таблица**            | **Назначение**                                                          | **Основные поля**                                                                                                                                                                         | **Ключи и индексы**                                                                                                      |
|------------------------|--------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|
| **users**              | Сведения о пользователях (покупатели, продавцы, админы).                 | `id PK`, `name`, `email`, `password`, `user_type`, `region`, `geolocation`, `created_at`, `updated_at`                                                                                     | - PK: `id`<br>- Unique Index: `email`<br>- Индекс по `region` (для сегментации, персонализации)                           |
| **products**           | Справочник товаров.                                                      | `id PK`, `seller_id (FK)`, `name`, `description`, `price`, `brand`, `image_url`, `created_at`, `updated_at`                                                                               | - PK: `id`<br>- Индексы: `seller_id`, `price`, `brand`                                                                    |
| **categories**         | Категории товаров (иерархия).                                           | `id PK`, `name`, `parent_id (FK -> self)`.                                                                                                                                                | - PK: `id`<br>- Индекс: `parent_id`<br>- Возможна материализация дерева, если нужно быстрый выбор всех «детей»            |
| **product_categories** | Связка многие-к-многим «товар – категория».                              | `product_id (FK), category_id (FK)`                                                                                                                                                       | - Составной PK: (`product_id`, `category_id`)                                                                             |
| **favorites**          | «Избранные» товары покупателя.                                           | `user_id (FK), product_id (FK), created_at`                                                                                                                                                | - Составной PK: (`user_id`, `product_id`)                                                                                |
| **views**              | Лог просмотров товаров пользователями (для аналитики, рекомендаций).     | `id PK, user_id (FK), product_id (FK), viewed_at`                                                                                                                                         | - Индексы: `user_id`, `product_id`<br>- Часто партиционируется по `viewed_at`                                                                                   |
| **search_queries**     | Лог поисковых запросов.                                                 | `id PK, user_id (FK), query, created_at`                                                                                                                                                  | - Индексы: `user_id`, `created_at`<br>- Партиционирование по датам для аналитики                                                                                |
| **carts**              | «Корзина» пользователя (головная часть корзины).                         | `id PK, user_id (FK), created_at, updated_at`                                                                                                                                             | - Индекс: `user_id`                                                                                                       |
| **cart_items**         | Позиции товаров в корзине.                                              | `id PK, cart_id (FK), product_id (FK), quantity, created_at, updated_at`                                                                                                                  | - Индексы: `cart_id`, `product_id`                                                                                       |
| **orders**             | Оформленные заказы.                                                      | `id PK, user_id (FK), order_date, status, payment_method, shipping_method, ... total_amount, created_at, updated_at`                                                                       | - Индексы: `user_id`, `status`, `order_date`                                                                              |
| **order_items**        | Товары в составе заказа (дублируют цену, количество на момент покупки).  | `id PK, order_id (FK), product_id (FK), quantity, unit_price, total_price, created_at, updated_at`                                                                                        | - Индексы: `order_id`, `product_id`                                                                                      |
| **payments**           | Информация об оплатах (в одном заказе может быть несколько платежей).    | `id PK, order_id (FK), amount, payment_date, status, payment_method, transaction_id, created_at, updated_at`                                                                               | - Индексы: `order_id`, `status`                                                                                           |
| **shipment_tracking**  | Информация об отслеживании доставки.                                     | `id PK, order_id (FK), tracking_number, status, updated_at`                                                                                                                               | - Индекс: `order_id`                                                                                                      |

---

### 6.2.2. Индексы

В каждой таблице предусмотрены следующие основные индексы:

1. **Первичные ключи (Primary Key)**:
   - `id` (PK) в большинстве таблиц (или составной PK для таблиц-связок).
2. **Уникальные индексы**:
   - `users(email)`, чтобы исключить дублирование e-mail.
3. **Внешние ключи (FK)**:
   - Например, `seller_id -> users.id` в `products`, `user_id -> users.id` в `favorites`, и т. п.
4. **Частые индексы для фильтрации**:
   - `price` и/или `brand` в таблице `products` (при выдаче каталога).
   - `status` в `orders` или `payments`.
   - `created_at` в логирующих таблицах, чтобы быстро находить записи за нужный период.
5. **Составные индексы** (при необходимости, например `(status, order_date)`), если часто фильтруем по статусу и дате одновременно.  
   В dbdiagram.io их можно отметить комментарием.

**Обоснование**: индексы формируются исходя из частых сценариев чтения/записи и фильтрации (WHERE user_id = ?; WHERE brand = ?; WHERE date between ? and ? и т.д.).

---

### 6.2.3. Денормализация

Денормализация может потребоваться для ускорения выборок и снижения количества JOIN:

1. **Копирование «названия категории» в `products`**  
   Если часто требуется выводить название категории без дополнительного JOIN, можно хранить **дублированное** поле `category_name` (или целый массив категорий) в `products`. Но это усложняет синхронизацию при изменении категорий.

2. **Предрасчитанные итоги/статистика**  
   - Например, чтобы в «личном кабинете продавца» быстро показывать число заказов, можно в отдельной таблице (или в Redis-кэше) вести агрегаты (итоги по продажам, остаткам и т.п.).  
   - Для аналитики просмотров, заказов, поисковых запросов обычно создаются **материализованные представления** или **отдельные витрины** данных в системах BigData (ClickHouse, Hadoop, т.д.).

3. **Кэширование часто запрашиваемых данных**  
   - Кэш в Redis (либо Memcached) для самых горячих запросов («ТОП-товары», «последние просмотренные»).  
   - CDN для раздачи статики (изображения, CSS/JS).

> **Принцип**: максимальную нормализацию используем в транзакционных таблицах (orders, payments). Денормализация — для ускорения чтения в высоконагруженных сервисах (каталог, аналитика).

---

### 6.2.4. Выбор СУБД (потаблично)

Современные маркетплейсы используют **гибридный подход**:

| **Таблица / Данные**            | **Типичные требования**                                   | **Рекомендуемая СУБД**                                                           | **Комментарий**                                                                                          |
|---------------------------------|------------------------------------------------------------|-----------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| **users**, **orders**, **payments**, **products**, **carts** … | Транзакционные операции, ACID, гарантия целостности.       | **Реляционная СУБД (PostgreSQL / MySQL / Oracle)**                       | Оптимально хранить в одной транзакционной БД для атомарности и связей.                                    |
| **views**, **search_queries**   | Огромные объёмы логов, аналитика, быстрые вставки, партиции | **ClickHouse**, **Hive**, **BigQuery** или др. аналитические/колоночные хранилища | В оперативной системе можно держать «последние X дней» для быстрых рекомендаций, остальное — в DWH.       |
| **categories**, **product_categories** | Справочники, дерево категорий                            | **Та же реляционная СУБД** (для удобства JOIN)                                  | Небольшие объёмы данных; удобно хранить в PostgreSQL/MySQL вместе с основными данными.                    |
| **Поисковый индекс**            | Полнотекстовый поиск, ранжирование, поиск по описанию       | **Elasticsearch**, **OpenSearch** (или Sphinx, SOLR и т.д.)                    | Используется как дополнительный поиск; обновляется из транзакционной БД.                                  |
| **Статические файлы** (изображения товаров) | Большие бинарные объёмы                                  | **Object Storage** (S3-совместимые, MinIO и т.п.)                               | В самой БД хранить только метаданные (URL). Основной объём — в отдельном файловом/объектном хранилище.     |

> **Основная Транзакционная БД**: PostgreSQL (или MySQL).  
> **Логи и аналитика**: ClickHouse / BigQuery / Snowflake.  
> **Поисковый движок**: Elasticsearch / OpenSearch.  
> **Хранилище изображений**: S3-совместимое, CDN для раздачи.


---

### 6.2.5. Шардирование и резервирование (репликация) СУБД

#### Шардирование

1. **Шардирование по пользователям (user_id)**  
   - Таблицы, связанные с активностью пользователя: `views`, `favorites`, `search_queries`, `carts`, а также часть `orders` (хотя у заказов обычно глобальные айди).  
   - Можно завести **N шард** (postgresql instances), распределяя пользователей по диапазонам user_id или по хешу (user_id mod N).  
   - Достоинство: обращения к одному пользователю сосредоточены на одном шарде.  
   - Недостаток: требуется распределённая логика при запросах глобальной аналитики.

2. **Партиционирование по дате** (или по датам + user_id)  
   - Большие лог-таблицы (`views`, `search_queries`) — дробим по временным интервалам (партиции по месяцу/неделе).  
   - Упрощает очистку (retention) и ускоряет запросы по недавним данным.

#### Репликация

- **Master-Slave (Primary-Replica)**:  
  - Master/Primary обрабатывает запись (INSERT/UPDATE), реплики синхронизируются асинхронно или синхронно.  
  - Чтение (SELECT) может идти на реплики для разгрузки мастера.
- **Геораспределённая репликация** для отказоустойчивости (если основной ЦОД вышел из строя).  
- **СУБД для аналитики** (ClickHouse и др.) может получать данные через **стриминг/ETL** в near real-time.

> Для транзакционной БД (PostgreSQL) обычно настраивают пару-тройку реплик (по географии), а для логов используют отказоустойчивый кластер ClickHouse.

---

### 6.2.6. Клиентские библиотеки / интеграции

- **Транзакционная СУБД**: драйверы PostgreSQL (например, `libpq`, `pgJDBC`, `Npgsql` для .NET, `psycopg2` для Python).  
- **Поисковый движок**: интеграция через REST API Elasticsearch или клиентские библиотеки. Синхронизация (ETL) из основной БД.  
- **Аналитическая БД**: коннекторы и утилиты (например, Kafka + ClickHouse, Debezium для CDC).  
- **Object Storage (S3)**: через HTTP/S3-протокол (AWS SDK, MinIO client, etc.).  
- **Redis**: для кеширования и быстрой выдачи самых популярных запросов.




### 6.2.7. Балансировка запросов / мультиплексирование подключений

1. **Connection Pooling**:
   - Использование PgBouncer (для PostgreSQL) или ProxySQL (MySQL) для управления пулом соединений.  
   - Сокращает overhead при установке множества коротких соединений.
2. **Load Balancing**:
   - Запросы на чтение отправляем на реплики.  
   - Пишущие запросы (INSERT/UPDATE) — на Primary.
3. **API-шлюзы** или **Reverse Proxy** (Nginx, HAProxy) на уровне веб-приложения — для маршрутизации и распределения нагрузки.
4. **Микросервисная архитектура**:  
   - Сервисы поиска идут в Elasticsearch,  
   - Сервис заказов — в транзакционную БД,  
   - Сервис аналитики — в ClickHouse.  
   Логика разделяется, а запросы балансируются по разным кластерам.

---

### 6.2.8. Схема резервного копирования

Для **транзакционной PostgreSQL**:
 
- **WAL-логирование** (архивирование WAL) в режиме point-in-time recovery. Позволяет восстанавливать БД до конкретного момента.  

Для **больших лог-таблиц** (ClickHouse и т.п.):

- Хранятся реплики на нескольких узлах (distributed replication).  
- Партиции за старые даты можно архивировать во внешний storage (S3).  
- Возможен вариант «основные данные – в кластере, старше года – в Glacier / холодном хранилище».

Для **объектного хранилища** (S3):

- Версионирование (versioning) включено, копии в разных зонах доступности.  
- Регулярные копии на «deep archive» при необходимости.

---

## Таблица 1. Основные характеристики использования Elasticsearch в Wildberries

| **Параметр**                    | **Описание**                                                                                                                                                                                                                      | **Обоснование**                                                                                                               |
|---------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| **Индексируемые данные**         | Карточки товаров из таблицы `products`: название, описание, характеристики, бренд, цена, категория и прочие атрибуты для полнотекстового поиска и фильтрации.                                                         | Необходимо обеспечить быстрый и качественный поиск по ключевым параметрам товара для улучшения UX (WBDay 2023).                   |
| **Обновление данных**            | Потоковая синхронизация изменений из PostgreSQL с помощью CDC-инструментов (Debezium, Kafka). Изменения передаются в Elasticsearch в near real-time.                                                                           | Быстрое обновление обеспечивает актуальность данных на сайте, что критично для динамичных цен и складских остатков (Kafka, CDC).      |
| **Что ищется**                 | Полнотекстовый поиск по текстовым полям; фильтрация по цене, бренду, категории; автодополнение, корректировка опечаток и использование синонимов.                                                                             | Комплексный поиск должен учитывать все аспекты товаров для достижения высокого уровня релевантности (SellerMoon, WB Tech).         |
| **Производительность**           | Масштабируемый распределённый кластер с распределением по шартам и репликам, рассчитанный на высокий трафик.                                                                                                                     | Высокая нагрузка (миллионы запросов) требует горизонтального масштабирования и отказоустойчивости (WBDay 2023, Habr Career).        |
| **Примеры запросов**             | Запросы вида «кроссовки Nike» – поиск с морфологией, фильтрация по цене и бренду, автодополнение подсказок.                                                                                                                     | Такие запросы соответствуют реальным сценариям пользователей, что повышает качество поиска (аналитика SellerMoon).                 |
| **Логика ранжирования**          | Комбинация стандартного поиска (TF/IDF) с ML-моделью, учитывающей продажи, конверсию, скорость доставки, отзывы и рейтинги.                                                                                                     | Гибридная модель позволяет увеличить коммерческую эффективность поиска – товары с хорошими продажами и отзывами показываются выше (WBDay 2023, WB Tech). |
| **Интеграция с PostgreSQL**      | PostgreSQL хранит мастер-данные, а их изменения моментально передаются через Kafka в Elasticsearch для обновления индекса.                                                                                                         | Такой подход гарантирует согласованность данных между операционной БД и поисковым индексом, что критично для актуальности (Debezium, Kafka). |

> **Пояснение:** Использование Elasticsearch вместе с PostgreSQL обеспечивает высокоскоростной поиск и эффективное обновление данных. Интеграция через CDC помогает поддерживать актуальность индекса, а применение ML-моделей повышает релевантность выдачи (WBDay 2023, Habr Career, SellerMoon).

---

## Таблица 2. Шардирование для индекса Elasticsearch и таблицы `products`

| **Система**        | **Объект**                   | **Объём данных**                                      | **Количество primary-шардов** | **Стратегия шардинга**                                       | **Репликация**                                                                      | **Обоснование**                                                                                                                                           |
|--------------------|------------------------------|-------------------------------------------------------|-------------------------------|--------------------------------------------------------------|-------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Elasticsearch**  | Индекс товаров (products)    | ~150 млн документов, размер – сотни Гб                | Примерно 10                   | Распределение по хешу ID товара для равномерного распределения | Каждому primary-шарду соответствует минимум 1 реплика для отказоустойчивости и масштабирования чтения. | Выравнивание нагрузки между серверами позволяет обеспечивать быстрый поиск при больших объемах данных, а реплики – повысить отказоустойчивость (WBDay 2023, Habr Career).    |
| **PostgreSQL**     | Таблица `products`           | ~150 млн записей, объем – десятки Гб                   | Логическое шардингование на 10 частей (например, по `ID mod 10`) | Горизонтальное разбиение по диапазону или вычисляемому ключу (на основе ID)           | Настроена схема master-slave с 1–2 репликами для обеспечения высокой доступности и резервного копирования.     | Горизонтальное шардингование позволяет эффективно распределять транзакционную нагрузку, обеспечивая баланс между операциями чтения и записи (Postgres, Habr Career). |

> **Пояснение:** Разбиение как индекса в Elasticsearch, так и таблицы в PostgreSQL на примерно 10 частей помогает равномерно распределить нагрузку и данные. Репликация обеспечивает высокую доступность и снижение риска отказа, что критически важно при работе с миллионами документов (WBDay 2023, SellerMoon).

---

- WBDay 2023 – данные с выступления представителей Wildberries;  
- Habr Career – вакансии и обсуждения технического стека Wildberries;  
- SellerMoon – аналитика факторов ранжирования и оптимизации карточек;  
- WB Tech – информация о развитии технологий поиска в Wildberries;  
- CDC/Kafka – обоснование выбора технологий для синхронизации данных.

---



## 7. Алгоритмы, используемые в Wildberries

| **Алгоритм**                        | **Область применения**                     | **Мотивация (цель)**                                                |
|-------------------------------------|--------------------------------------------|---------------------------------------------------------------------|
| **Персональные рекомендации**      | Лента товаров для конкретного пользователя, блоки «с этим товаром покупают» и т.п. | Увеличение конверсии и удержания: показать каждому пользователю наиболее релевантные товары, которые ему понравятся, повысив вероятность покупки. |
| **Полнотекстовый поиск и ранжирование** | Поиск товаров по ключевым словам, сортировка результатов | Быстрая и точная выдача товаров, удовлетворяющих запрос, с учетом качества товара и бизнеса: найти нужный товар и одновременно продвигать быструю доставку и надежных продавцов. |
| **Динамическое ценообразование**    | Определение и корректировка цен товаров (и скидок) в реальном времени | Максимизация прибыли и конкурентоспособности: адаптировать цены под спрос, сезон, конкурентов и акции, чтобы привлечь покупателей и обеспечить прибыль продавцу. |
| **Логистические алгоритмы**        | Прогноз сроков доставки, выбор склада отгрузки, маршрутизация доставки | Повышение оперативности и эффективности доставки: минимизировать время и стоимость доставки каждого заказа, выполняя обещанные сроки и уменьшая возвраты по причине задержек. |
| **Персонализация выдачи в каталоге** | Персонализированная сортировка товаров в категориях и поиске для каждого пользователя | Улучшение пользовательского опыта: учитывать предпочтения, историю просмотров и покупок клиента при показе товаров, чтобы каждая аудитория видела более интересные для нее товары и чаще совершала покупки. |

## Алгоритмы персональных рекомендаций

**Источники данных.** В Wildberries собираются обширные данные о действиях пользователей: поисковые запросы, просмотры товаров, клики, добавление в корзину, покупки, оценки и отзывы. Эти события фиксируются в логах и хранилищах данных. Кроме поведенческих данных, учитываются свойства самих товаров – категория, бренд, описание, цена и т.д. – а также демографические данные пользователя (пол, возраст). 

**Этапы работы алгоритма.** 
1. **Сбор и подготовка данных:** на первом этапе данные об интеракциях пользователя с платформой агрегируются. Формируется профиль пользователя: категории товаров, которыми он интересуется, бренды, ценовой сегмент, предпочитаемый размер/цвет и т.п. Также строятся связи между товарами – какие товары часто просматривают или покупают вместе (граф «пользователь–товар» или «товар–товар»).
2. **Генерация кандидатов:** на основе профиля алгоритмы генерируют список кандидатных рекомендаций. Применяются разные подходы: классические модели коллаборативной фильтрации (например, матричная факторизация) рекомендуют товары, похожие на те, что пользователь уже покупал или оценивал; content-based фильтрация – товары с похожими атрибутами; модели на графах – находят товары, связанные с пользователем через граф взаимодействий. В Wildberries, например, исследуется использование **графовых нейронных сетей** (LightGCN) для рекомендации товаров через пользователь-товар граф ([Графовые сети в рекомендательных системах / Хабр](https://habr.com/ru/companies/wildberries/articles/826422/#:~:text=%D0%92%D1%81%D0%B5%D0%BC%20%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82%21%20%D0%9C%D0%B5%D0%BD%D1%8F%20%D0%B7%D0%BE%D0%B2%D1%83%D1%82%20%D0%90%D0%BB%D0%B5%D0%BA%D1%81%D0%B0%D0%BD%D0%B4%D1%80,%D0%BD%D0%B0%D1%88%D0%B8%D0%BC%20%D0%BF%D0%BE%D0%B4%D1%85%D0%BE%D0%B4%D0%B0%D0%BC%20%D0%BA%20%D0%BF%D0%BE%D1%81%D1%82%D1%80%D0%BE%D0%B5%D0%BD%D0%B8%D1%8E%20%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B9)) ([Графовые сети в рекомендательных системах / Хабр](https://habr.com/ru/companies/wildberries/articles/826422/#:~:text=,%D0%B8%20%D0%B2%D0%B0%D1%80%D0%B8%D0%B0%D0%BD%D1%82%D1%8B%20%D0%B8%D1%85%20%D1%83%D1%81%D1%82%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F)). Это повышает охват за счет поиска новых («exploration»), а не только популярных, товаров.
3. **Ранжирование рекомендаций:** после получения набора кандидатов, специальная модель ранжирования сортирует их по вероятности заинтересовать пользователя. Модель учитывает множество признаков: схожесть товара с историей пользователя, общий рейтинг и качество товара, новизна, сезонность, текущие акции и т.д. Например, если пользователь ранее искал кроссовки определенного бренда, то товары этого бренда получат повышенный скор в ранжировании для данного пользователя.
4. **Показ и обратная связь:** верхние N рекомендаций отображаются пользователю в рекомендательной ленте или в блоке «Вам может понравиться». Далее собирается обратная связь – клики по рекомендованным товарам, добавление в корзину или игнорирование. Эти сигналы (CTR рекомендаций, длительность просмотра) используются для периодического переобучения моделей, чтобы улучшать их качество. Обучение моделей происходит регулярно на обновленных данных, учитывая свежие тренды интересов. Например, если пользователь начал интересоваться новой категорией (спорттовары), алгоритм со временем подстроится и начнет предлагать спортивные товары более активно.

**Метрики оценки качества.** Качество рекомендательной системы измеряется как оффлайн, так и онлайн. Оффлайн применяются метрики ранжирования, сравнивая рекомендации с историческими данными: например, **NDCG@K** – показатель, насколько высоко в списке находятся действительно купленные/интересные пользователю товары ([Графовые сети в рекомендательных системах / Хабр](https://habr.com/ru/companies/wildberries/articles/826422/#:~:text=)). Также вычисляются метрики диверсификации и новизны – например, **Intra-List Diversity** (разнообразие списка) и **доля популярности** в рекомендациях (AIRTS), чтобы рекомендации не состояли только из однотипных популярных позиций ([Графовые сети в рекомендательных системах / Хабр](https://habr.com/ru/companies/wildberries/articles/826422/#:~:text=match%20at%20L300%20%D0%A1%D0%BC%D0%B5%D1%89%D0%B5%D0%BD%D0%B8%D0%B5%20%D0%B2,%D1%81%D0%BA%D0%B0%D0%B7%D1%8B%D0%B2%D0%B0%D0%B5%D1%82%D1%81%D1%8F%20%D0%BD%D0%B0%20%D0%B5%D0%B3%D0%BE%20%D1%83%D0%B4%D0%BE%D0%B2%D0%BB%D0%B5%D1%82%D0%B2%D0%BE%D1%80%D0%B5%D0%BD%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%BC)) ([Графовые сети в рекомендательных системах / Хабр](https://habr.com/ru/companies/wildberries/articles/826422/#:~:text=match%20at%20L468%20%D0%92%D0%B5%D0%BB%D0%B8%D1%87%D0%B8%D0%BD%D0%B0%20AIRTS,%D1%81%D1%80%D0%B5%D0%B4%D0%BD%D1%8F%D1%8F%20%D0%B4%D0%BE%D0%BB%D1%8F%20%D1%82%D0%BE%D0%BF%D0%B0%20%D0%B2%20%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D1%8F%D1%85)). Онлайн-метриками служат CTR блока рекомендаций, конверсия в покупку из рекомендаций, средний доход на пользователя. Также Wildberries отслеживает влияние рекомендаций на общий пользовательский опыт, например, с помощью NPS (индекса удовлетворенности) ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=match%20at%20L139%20%D0%B4%D0%BE%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%20%D1%87%D1%83%D0%B2%D1%81%D1%82%D0%B2%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9,%D1%8D%D1%82%D0%BE%D0%BC%20%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C%20%D0%B5%D0%B3%D0%BE%20%D0%B4%D0%BE%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%20%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%BC)). Практически все изменения алгоритмов проверяются через A/B-тесты на доле пользователей и сравниваются по ключевым метрикам ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=match%20at%20L114%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D0%BC%20%D0%BF%D1%80%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D1%82%D1%8C,%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D0%BA%D0%B8%20%D0%B8%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D1%83%D1%8E%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C%20%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9)).


## Алгоритмы полнотекстового поиска и ранжирования

**Источники данных.** Поисковый механизм Wildberries опирается на данные каталога товаров и пользовательские запросы. Индекс поисковой системы включает *названия товаров, описания, характеристики, бренд, категорию* и прочие поля каждой карточки товара. При этом учитывается структура описания: алгоритм отличает основные характеристики товара от второстепенных деталей или маркетингового текста ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=,%D1%82%D0%B5%D0%BC%D0%B0%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%BC%D0%B8%20%D0%BF%D0%BE%D0%B4%D0%B0%D1%80%D0%BA%D0%B0%D0%BC%D0%B8%2C%20%D0%B2%D1%81%D1%82%D1%80%D0%B5%D1%87%D0%B0%D1%8E%D1%82%D1%81%D1%8F%20%D0%BE%D1%87%D0%B5%D0%BD%D1%8C%20%D1%80%D0%B5%D0%B4%D0%BA%D0%BE)). Например, для запроса по бренду акцент делается на поле «Бренд» карточки ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B8%D1%80%D1%83%D0%B5%D1%82%20%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8E%20%D0%B2%20%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%BA%D0%B5%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0,%D0%BF%D0%BE%D0%BD%D0%B8%D0%B7%D0%B8%D1%82%D1%8C%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%20%D0%B2%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D1%85%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8)). Также используется история поисковых запросов и кликов: система обучается на том, какие товары пользователи выбирали по тем или иным запросам. Команда поисковой оптимизации привлекает *асессоров* – специалистов, вручную оценивающих релевантность выдачи по выбору запросов ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9F%D0%BE%D0%B8%D1%81%D0%BA%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%BE%D0%B2%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%20%D0%B8,%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D0%B8%20%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0%20%D0%B8%20%D1%88%D1%82%D0%B0%D1%82%20%D0%B0%D1%81%D0%B5%D1%81%D1%81%D0%BE%D1%80%D0%BE%D0%B2)). Их оценки служат «эталоном» для тонкой настройки алгоритмов и обучения моделей ранжирования. Наконец, бизнес-данные о товарах тоже влияют на поиск: статистика продаж, рейтинг товара, наличие на складе, география доступности и т.д.

**Этапы работы алгоритма.** 
1. **Обработка запроса:** когда пользователь вводит запрос, поисковый модуль проводит предобработку. Выполняется исправление опечаток (спеллчек), приведение слов к нормальной форме, учет синонимов. Wildberries анализирует и «понимает» запрос: например, определяет, что запрос `кроссовки найк женские` содержит бренд *Nike* и категорию *женские кроссовки*. Если запрос редкий или тематический (например, подарок на праздник), алгоритм может использовать эвристику или отдельную логику, так как такие запросы встречаются редко и трудно однозначно интерпретируются ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%D0%B8%D1%80%D1%83%D0%B5%D1%82%20%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8E%20%D0%B2%20%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%BA%D0%B5%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0,%D0%BF%D0%BE%D0%BD%D0%B8%D0%B7%D0%B8%D1%82%D1%8C%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%20%D0%B2%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D1%85%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8)).
2. **Поиск кандидатов по тексту:** на основе обработанного запроса система извлекает из поискового индекса товары, связанные по смыслу. Важно, что совпадение может быть не прямым – алгоритм использует семантический анализ. Например, товар может не содержать конкретное слово из запроса, но система все равно выдаст его, если по совокупности характеристик и поведению пользователей он соответствует спросу ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=,%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%20%D0%B2%20%D0%BF%D0%BE%D0%BB%D0%B5%20%C2%AB%D0%B1%D1%80%D0%B5%D0%BD%D0%B4%C2%BB)). По сути, на этом этапе работает механизм сопоставления слов запроса с информацией в карточке товара (возможно, синонимов, морфологии). Результатом этапа является множество товаров-кандидатов, удовлетворяющих запросу по базовой текстовой релевантности.
3. **Фильтрация и анти-спам:** параллельно применяется фильтр качества. Wildberries ежедневно обучает систему различать допустимую и недопустимую информацию в карточках ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%B1%D1%80%D0%B5%D0%BD%D0%B4%D0%B0%2C%20%D1%81%D0%BA%D0%BE%D1%80%D0%B5%D0%B5%20%D0%B2%D1%81%D0%B5%D0%B3%D0%BE%20%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%20%D0%B1%D1%83%D0%B4%D0%B5%D1%82,%D0%BF%D0%BE%D0%BD%D0%B8%D0%B7%D0%B8%D1%82%D1%8C%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%20%D0%B2%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D1%85%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8)). Если товарная карточка содержит запрещенные слова или «черную оптимизацию» (например, перечисление десятков нерелевантных ключевых слов, лишние спецсимволы, капслок для привлечения внимания), то такой товар *понижается* в выдаче или исключается ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=,%D0%BF%D0%BE%D0%BD%D0%B8%D0%B7%D0%B8%D1%82%D1%8C%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%20%D0%B2%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D1%85%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8)). К примерам плохих практик, не повышающих место в выдаче, относятся: перечисление множества синонимов, дублирование одного слова много раз, не относящиеся к товару разделы текста, бессмысленные символы и хэштеги ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9D%D0%B8%20%D0%BE%D0%B4%D0%B8%D0%BD%20%D0%B8%D0%B7%20%D0%BF%D0%B5%D1%80%D0%B5%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D1%85%20%D0%BF%D1%80%D0%B8%D0%B5%D0%BC%D0%BE%D0%B2%C2%A0%D0%BD%D0%B5,%D0%BF%D0%BE%D0%B2%D1%8B%D1%88%D0%B0%D0%B5%D1%82%20%D0%BC%D0%B5%D1%81%D1%82%D0%BE%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%20%D0%B2%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B5)). Алгоритм распознает такие случаи и снижает их влияние.
4. **Многофакторное ранжирование:** для отфильтрованных кандидатов рассчитывается итоговый **скор (оценка релевантности)** с учетом множества факторов. В упрощенном виде Wildberries раскрыл ключевые группы факторов и их примерную важность:
   - **Объем продаж товара.** Этот фактор отражает популярность товара у покупателей и составляет ~10–25% вклада в ранжирование ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9E%D0%B1%D1%8A%D1%91%D0%BC%D1%8B%20%D0%BF%D1%80%D0%BE%D0%B4%D0%B0%D0%B6%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0)). Рассчитывается сумма продаж в рублях за недавний период (продажи за последние дни более значимы, чем месячной давности). Высокие продажи сигнализируют, что товар востребован. Возвраты и отмены заказов вычитаются, а попытки искусственно накрутить продажи (например, самовыкупы продавцом) отслеживаются и обнуляют вклад товара ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A1%D1%87%D0%B8%D1%82%D0%B0%D0%B5%D1%82%D1%81%D1%8F%20%D0%BE%D0%B1%D1%8A%D1%91%D0%BC%20%D0%BF%D1%80%D0%BE%D0%B4%D0%B0%D0%B6%20%D0%B2%20%D1%80%D1%83%D0%B1%D0%BB%D1%8F%D1%85%2C,%D0%B0%20%D0%BD%D0%B5%20%D0%B2%20%D1%88%D1%82%D1%83%D0%BA%D0%B0%D1%85)). Кроме того, учитываются только те вариации (SKU), что есть в наличии: если какой-то размер/цвет распродан и отсутствует сейчас, его прошлые продажи не учитываются ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%95%D1%81%D0%BB%D0%B8%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0%20%D0%B7%D0%B0%D0%BF%D0%BE%D0%B4%D0%BE%D0%B7%D1%80%D0%B8%D1%82%20%D0%BC%D0%BE%D1%88%D0%B5%D0%BD%D0%BD%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%B5%20%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D1%8F,%D0%BD%D0%B5%20%D0%B1%D1%83%D0%B4%D0%B5%D1%82%20%D1%83%D1%87%D0%B8%D1%82%D1%8B%D0%B2%D0%B0%D1%82%D1%8C%D1%81%D1%8F%20%D0%BF%D1%80%D0%B8%20%D1%80%D0%B0%D1%81%D1%87%D1%91%D1%82%D0%B5)).
   - **Время и расстояние доставки.** Фактор логистики – один из важнейших, ~30–40% влияния ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A0%D0%B0%D1%81%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D0%B5%20%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%BA%D0%B8%2C%20%D0%B2%D1%80%D0%B5%D0%BC%D1%8F%20%D1%81%D0%B1%D0%BE%D1%80%D0%BA%D0%B8%20%D0%B8,%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%BA%D0%B8%20%D0%B7%D0%B0%D0%BA%D0%B0%D0%B7%D0%B0)). Алгоритм оценивает, за сколько времени товар может быть доставлен конкретному покупателю, исходя из его местоположения и склада, где лежит товар. Чем быстрее доставка (меньше расстояние), тем выше товар поднимется в поиске, ведь пользователям важно получить покупку быстро ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%92%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D0%B5%3A%20%D0%BE%D1%82%2030%20%D0%B4%D0%BE%2040)). Это стимулирует продавцов распределять товар по складам ближе к покупателям. Также сюда включено время сборки заказа на складе: товары, которые быстрее комплектуются и отправляются, получают преимущество.
   - **Конверсия товара.** Вклад ~5–20% ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9A%D0%BE%D0%BD%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F)). Конверсия – это показатель, насколько эффективно товар продается относительно показов. Система рассчитывает несколько этапов конверсии: процент, с которым товар из поисковой выдачи привлекает клик (переход в карточку), затем процент переходов в заказы, и в выкуп (оплаченные полученные заказы) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9A%D0%BE%D0%BD%D0%B2%D0%B5%D1%80%D1%81%D0%B8%D1%8F%20%E2%80%94%20%D1%8D%D1%82%D0%BE%20%D0%BE%D1%82%D0%BD%D0%BE%D1%81%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9%20%D0%BF%D0%BE%D0%BA%D0%B0%D0%B7%D0%B0%D1%82%D0%B5%D0%BB%D1%8C,%D1%80%D0%B5%D0%B4%D0%BA%D0%BE%20%D0%BF%D1%80%D0%B8%20%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%BE%D0%BC%20%D1%87%D0%B8%D1%81%D0%BB%D0%B5%20%D0%BF%D0%BE%D0%BA%D0%B0%D0%B7%D0%BE%D0%B2)). Если товар часто показывается, но мало кто его покупает, алгоритм посчитает его менее релевантным (“не оправдывает место в топе”) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%92%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D0%B5%3A%20%D0%BE%D1%82%205%20%D0%B4%D0%BE%2020)). Высокая конверсия же означает, что товар соответствует запросам – люди его выбирают.
   - **Релевантность текста.** Хотя точные веса не раскрыты, текстовое соответствие запросу тоже влияет. Алгоритм сопоставляет слова запроса с названием, характеристиками и описанием карточки ([[I'ML] Ранжирование и ретривел - YouTube](https://www.youtube.com/watch?v=ncN4wZNwz94#:~:text=%5BI%27ML%5D%20%D0%A0%D0%B0%D0%BD%D0%B6%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5%20%D0%B8%20%D1%80%D0%B5%D1%82%D1%80%D0%B8%D0%B2%D0%B5%D0%BB%20,%D0%9F%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D1%8B%D0%B5)), и вычисляет базовую текстовую релевантность. Этот фактор обеспечивает, что по запросу “красное платье” наверху будут именно платья красного цвета. Но его вес невелик по сравнению с бизнес-факторами – по оценкам, текстовое соответствие дает порядка 5% влияния (для сравнения, у Ozon текст имеет ~10% веса) ([Алгоритмы ранжирования Wildberries: что влияет на выдачу ...](https://reklama.tochka.com/blog/poiskovye-algoritmy-wildberries#:~:text=%D0%90%D0%BB%D0%B3%D0%BE%D1%80%D0%B8%D1%82%D0%BC%D1%8B%20%D1%80%D0%B0%D0%BD%D0%B6%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F%20Wildberries%3A%20%D1%87%D1%82%D0%BE%20%D0%B2%D0%BB%D0%B8%D1%8F%D0%B5%D1%82,%E2%80%94%20%D0%BE%D1%82%205%20%D0%B4%D0%BE)).
   - **Контент карточки (наполненность).** Небольшой фактор (<1%) – качество заполнения карточки товара ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A0%D0%B5%D0%B9%D1%82%D0%B8%D0%BD%D0%B3%20%D0%B7%D0%B0%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F%20%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%BA%D0%B8)). Если у товара подробное описание, характеристики, хорошие фото, он получит чуть больше баллов. Это мотивирует продавцов заполнять карточки информативно. Однако переусердствовать бесполезно: избыточный текст или ключевые слова, как упоминалось, не дают преимущества ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9D%D0%B8%20%D0%BE%D0%B4%D0%B8%D0%BD%20%D0%B8%D0%B7%20%D0%BF%D0%B5%D1%80%D0%B5%D1%87%D0%B8%D1%81%D0%BB%D0%B5%D0%BD%D0%BD%D1%8B%D1%85%20%D0%BF%D1%80%D0%B8%D0%B5%D0%BC%D0%BE%D0%B2%C2%A0%D0%BD%D0%B5,%D0%BF%D0%BE%D0%B2%D1%8B%D1%88%D0%B0%D0%B5%D1%82%20%D0%BC%D0%B5%D1%81%D1%82%D0%BE%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%20%D0%B2%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B5)).
   - **Рейтинг продавца.** Влияние ~3–10% ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A0%D0%B5%D0%B9%D1%82%D0%B8%D0%BD%D0%B3%20%D0%BF%D1%80%D0%BE%D0%B4%D0%B0%D0%B2%D1%86%D0%B0)). Wildberries вычисляет внутренний рейтинг надежности продавца, а также учитывает отзывы на его товары. Во-первых, *средние оценки и отзывы* по товару влияют до 4% – товар с множеством хороших отзывов будет выше, чем аналогичный с плохими ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9E%D1%82%D1%80%D0%B0%D0%B6%D0%B0%D0%B5%D1%82%20%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%BE%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%2C%20%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%B9%20%D0%BF%D1%80%D0%B5%D0%B4%D0%BE%D1%81%D1%82%D0%B0%D0%B2%D0%BB%D1%8F%D0%B5%D1%82,%D0%92%D0%BA%D0%BB%D1%8E%D1%87%D0%B0%D0%B5%D1%82%20%D0%B4%D0%B2%D0%B0%20%D1%84%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%B0)). Во-вторых, *общий рейтинг продавца* (на базе статистики по всем его операциям) добавляет баллов. В этот рейтинг входят показатели: своевременность отправки заказов, процент выкупа (мало отказов покупателями), уровень брака и повреждений, отсутствие жалоб ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=1,%D0%9E%D0%BD%20%D0%B7%D0%B0%D0%B2%D0%B8%D1%81%D0%B8%D1%82%20%D0%BE%D1%82)). Алгоритм автоматически распознает накрученные или фальшивые отзывы и исключает их из расчета ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A0%D0%B5%D0%B9%D1%82%D0%B8%D0%BD%D0%B3%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%20%D0%B8%20%D0%BE%D1%82%D0%B7%D1%8B%D0%B2%D1%8B)), так что честные продавцы с хорошим сервисом находятся выше.
   - **Участие в акциях и скидках.** Очень весомый фактор – от 7% до 35% ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%B8%D0%B5%20%D0%B2%20%D0%BF%D1%80%D0%BE%D0%BC%D0%BE%2C%20%D1%81%D0%BA%D0%B8%D0%B4%D0%BA%D0%B8)). Wildberries постоянно проводит акции (распродажи, скидочные промокоды), и товары, предлагающие **выгодную цену**, получают преимущество в выдаче. Оптимальная цена при хорошем качестве – залог успеха, как отмечает Wildberries ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A3%D1%87%D0%B0%D1%81%D1%82%D0%B8%D0%B5%20%D0%B2%20%D0%BF%D1%80%D0%BE%D0%BC%D0%BE%2C%20%D1%81%D0%BA%D0%B8%D0%B4%D0%BA%D0%B8)). Во время небольших акций влияние фактора ~7–15%, а в периоды крупных распродаж (например, сезонных сейлов) вес повышается до 35% ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D1%84%D0%B8%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B0%2C%20%D0%B8%D0%BC%D0%B5%D0%BD%D0%BD%D0%BE%20%D0%B5%D0%B5%20%D0%B8,%D0%B2%D0%B8%D0%B4%D1%8F%D1%82%20%D0%BD%D0%B0%D1%88%D0%B8%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B8)). Проще говоря, товар со скидкой или по акционной цене будет показываться выше, стимулируя продавцов участвовать в промо.
   - **Реклама (платное продвижение).** С недавнего времени введен механизм аукционной рекламы **«Бустер»**, его вклад может достигать 17–30% ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%92%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D0%B5%3A%20%D0%BE%D1%82%2017%20%D0%B4%D0%BE%2030)). В выдаче поиска, каталога и даже рекомендаций теперь не ограничено число рекламных мест – *любое место может быть “куплено”*, но с условием релевантности. В формулу ранжирования просто добавлен дополнительный фактор = f(CPM, relevance) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%A1%20%D0%BD%D0%B5%D0%B4%D0%B0%D0%B2%D0%BD%D0%B5%D0%B3%D0%BE%20%D0%B2%D1%80%D0%B5%D0%BC%D0%B5%D0%BD%D0%B8%20%D0%B2%20Wildberries,%D0%B1%D0%BE%D0%BB%D1%8C%D1%88%D0%B5%D0%B9%20%D1%81%D1%82%D0%B5%D0%BF%D0%B5%D0%BD%D0%B8%20%D0%BE%D0%BF%D1%80%D0%B5%D0%B4%D0%B5%D0%BB%D1%8F%D0%B5%D1%82%D1%81%D1%8F%20%D0%B4%D0%B2%D1%83%D0%BC%D1%8F%20%D0%BF%D0%B0%D1%80%D0%B0%D0%BC%D0%B5%D1%82%D1%80%D0%B0%D0%BC%D0%B8)). CPM – ставка продавца за 1000 показов для этого товара, а *relevance* – насколько товар вообще подходит под запрос пользователя. Бустер вычисляет комбинацию: чем выше ставка *и* релевантность товара запросу, тем больше добавка к рейтингу ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=,relevance)). Если два товара конкурируют, то товар с более высокой ставкой поднимается, но только в пределах, допустимых его релевантностью. Таким образом, даже за деньги не выдвинуть в топ совсем неуместный товар. Формально можно представить advScore = α * CPM + β * relevance (параметры α, β подбираются под категорию и контекст) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%CE%B1%CE%B2%C2%A0advScore%C2%A0)). При уменьшении ставки эффект падает ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%BE%D1%82%20%D0%BA%D0%B0%D1%82%D0%B5%D0%B3%D0%BE%D1%80%D0%B8%D0%B8%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%2C%20%D0%BA%D0%BE%D0%BD%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D1%8F,%D0%B4)). Такой подход делает аукцион «честным» – качественный и релевантный товар продвигать дешевле, чем несоответствующий запросу ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9F%D1%80%D0%B8%20%D1%83%D0%BC%D0%B5%D0%BD%D1%8C%D1%88%D0%B5%D0%BD%D0%B8%D0%B8%20%D1%81%D1%82%D0%B0%D0%B2%D0%BA%D0%B8%20%D0%B8%2F%D0%B8%D0%BB%D0%B8%20%D1%80%D0%B5%D0%BB%D0%B5%D0%B2%D0%B0%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8,advScore%20%D1%81%D0%BD%D0%B8%D0%B6%D0%B0%D0%B5%D1%82%D1%81%D1%8F)). 
   - **Прочие факторы.** Есть и другие менее значимые элементы. Например, **уровень лояльности продавца** в программе Wildberries (бронзовый, серебряный, золотой) дает от +1% до +2% ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%92%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D0%B5%20%D1%83%D1%80%D0%BE%D0%B2%D0%BD%D0%B5%D0%B9%3A)). Новизна товара сама по себе не дает большого преимущества – новые товары ранжируются по тем же факторам, хотя алгоритм популярности для них немного скорректирован, чтобы дать шанс новичкам ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9F%D0%BE%D1%87%D0%B5%D0%BC%D1%83%20%D0%BD%D0%BE%D0%B2%D1%8B%D0%B9%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%20%D0%BD%D0%B5%20%D0%B2,%D0%A2%D0%9E%D0%9F%D0%B5%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8%20WB)). Геолокация пользователя может влиять: в разных регионах выдача может отличаться (например, товар, популярный в конкретном регионе или имеющий локальную специфику, покажется выше жителям этого региона). Также если пользователь авторизован, система может учитывать его сегмент (см. персонализацию выдачи ниже).

   После подсчета все кандидаты сортируются по полученной интегральной оценке релевантности (с учетом всех факторов) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%92%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B5%20%D1%80%D0%B0%D1%81%D1%81%D0%BC%D0%BE%D1%82%D1%80%D0%B5%D0%BD%D0%B8%D1%8F%20%D0%B2%D1%81%D0%B5%D1%85%20%D1%84%D0%B0%D0%BA%D1%82%D0%BE%D1%80%D0%BE%D0%B2,%D0%BA%D0%B0%D0%BD%D0%B4%D0%B8%D0%B4%D0%B0%D1%82%D0%B0%20%D0%BD%D0%B0%20%D0%BC%D0%B5%D1%81%D1%82%D0%B0%20%D0%B2%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B5)). Так формируется финальная поисковая выдача – то, что увидит пользователь ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%BE%D1%86%D0%B5%D0%BD%D0%BA%D0%B0%20%D1%80%D0%B5%D0%BB%D0%B5%D0%B2%D0%B0%D0%BD%D1%82%D0%BD%D0%BE%D1%81%D1%82%D0%B8%20%D0%BA%D0%B0%D0%B6%D0%B4%D0%BE%D0%B3%D0%BE%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0,%D0%BC%D0%B5%D1%81%D1%82%D0%B0%20%D0%B2%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B5)). При равных условиях между товарами возможна ротация, особенно в категориях с высокой конкуренцией, где алгоритм может пересчитывать выдачу очень часто (вплоть до обновления позиций в течение дня) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%9D%D0%B5%20%D0%BF%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D1%8F%D0%B9%D1%82%D0%B5%20%D0%BD%D0%B0%D0%BB%D0%B8%D1%87%D0%B8%D0%B5%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%20%D0%B2,%D0%B1%D0%BE%D1%82%D0%B0%D0%BC%D0%B8%20%D0%B8%20%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%BC%D0%B8%20%D0%B0%D0%BD%D0%B0%D0%BB%D0%B8%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%B8%D0%BC%D0%B8%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%B0%D0%BC%D0%B8)) ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=,%D0%B7%D0%B0%D0%BF%D1%80%D0%BE%D1%81%D1%83%2C%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B0%20%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D1%8F%D0%B5%D1%82%D1%81%D1%8F%20%D0%BA%D1%80%D0%B0%D0%B9%D0%BD%D0%B5%20%D0%B1%D1%8B%D1%81%D1%82%D1%80%D0%BE)).
5. **Выдача результатов и обучение модели:** пользователю отображается отсортированный список товаров. Дальнейшие клики, покупки или отсутствие взаимодействия дают сигнал обратной связи системе. Wildberries непрерывно анализирует, удовлетворяет ли пользователя поиск: например, высокий процент отказов от покупки или частые уточнения запроса могут указывать на проблему. Команда поиска запускает A/B-эксперименты с новыми моделями ранжирования и сравнивает метрики (конверсия после поиска, время на поиск, доля «нулевых» поисков без результатов и т.д.) ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D0%BC%20%D0%BF%D1%80%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D1%82%D1%8C%20%D0%BD%D0%BE%D0%B2%D1%8B%D0%B5%20%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D0%B8%20%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0%2F%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B9,%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D0%BA%D0%B8%20%D0%B8%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D1%83%D1%8E%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C%20%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9)). Модель машинного обучения, лежащая в основе ранжирования, периодически переобучается на накопленных данных взаимодействия (учитывая новые продажи, отзывы, успехи/неудачи рекомендаций). Благодаря этому поиск становится «умнее» со временем: подстраивается под новые тренды запросов, учится игнорировать попытки мошенничества и т.п. ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%B1%D1%80%D0%B5%D0%BD%D0%B4%D0%B0%2C%20%D1%81%D0%BA%D0%BE%D1%80%D0%B5%D0%B5%20%D0%B2%D1%81%D0%B5%D0%B3%D0%BE%20%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%20%D0%B1%D1%83%D0%B4%D0%B5%D1%82,%D0%BF%D0%BE%D0%BD%D0%B8%D0%B7%D0%B8%D1%82%D1%8C%20%D1%82%D0%BE%D0%B2%D0%B0%D1%80%20%D0%B2%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D1%85%20%D0%B2%D1%8B%D0%B4%D0%B0%D1%87%D0%B8)).

**Метрики качества поиска.** Основная цель поискового алгоритма – максимально удовлетворить пользователя в минимальное число действий. Для контроля качества используются:
- **Релевантность (оффлайн).** На основании оценок асессоров и известных успешных результатов измеряется метрика *NDCG@K* или *Precision@K* для выдачи по тестовому набору запросов. Это показывает, насколько высоко в среднем находятся действительно подходящие товары. Также следят за *Recall* (доля найденных релевантных товаров) – важно, чтобы алгоритм не упускал хорошие товары.
- **Онлайн-показатели поведения.** Доля пользователей, нашедших товар и совершивших покупку после поиска – прямая метрика успеха. Кроме конверсии из поиска, смотрят на *CTR результатов* (сколько результатов из топ-10 просматривается), *глубину поисковой сессии* (не приходится ли пользователю листать десятки страниц или переформулировать запрос). *Время до нахождения товара* и *коэффициент отказов* (когда пользователь покинул поиск, не кликнув ничего) тоже важны. 
- **Бизнес-метрики.* Wildberries также отслеживает общий вклад поиска в выручку. Улучшение ранжирования должно увеличивать продажи и не снижать, к примеру, средний чек. Один из индикаторов – *NPS (Net Promoter Score)* по впечатлению от поиска. На Хабре отмечалось, что NPS – чувствительный инструмент для оценки качества поиска, хотя сделать его абсолютно объективным сложно ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=match%20at%20L139%20%D0%B4%D0%BE%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%20%D1%87%D1%83%D0%B2%D1%81%D1%82%D0%B2%D0%B8%D1%82%D0%B5%D0%BB%D1%8C%D0%BD%D1%8B%D0%B9,%D1%8D%D1%82%D0%BE%D0%BC%20%D1%81%D0%B4%D0%B5%D0%BB%D0%B0%D1%82%D1%8C%20%D0%B5%D0%B3%D0%BE%20%D0%B4%D0%BE%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%20%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82%D0%B8%D0%B2%D0%BD%D1%8B%D0%BC)).
- **Стат. значимость изменений.** При выкладке нового алгоритма через A/B-платформу измеряется статистическая значимость разницы ключевых метрик с контрольной группой. Только убедившись, что метрики улучшились (например, конверсия выросла на +X% ± погрешность), команда закрепляет изменения в продакшене ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=match%20at%20L114%20%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82%D0%B0%D0%BC%20%D0%BF%D1%80%D0%B8%D0%BD%D0%B8%D0%BC%D0%B0%D1%82%D1%8C,%D0%BC%D0%B5%D1%82%D1%80%D0%B8%D0%BA%D0%B8%20%D0%B8%20%D1%81%D1%82%D0%B0%D1%82%D0%B8%D1%81%D1%82%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D1%83%D1%8E%20%D0%B7%D0%BD%D0%B0%D1%87%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C%20%D0%B8%D0%B7%D0%BC%D0%B5%D0%BD%D0%B5%D0%BD%D0%B8%D0%B9)).


## Алгоритмы динамического ценообразования

**Источники данных.** Алгоритмы ценообразования на Wildberries опираются на данные о спросе и предложении в реальном времени. Основные источники:
- *Данные о продажах товара:* сколько штук продается в день, скорость продаж, остатки на складе. Эти данные важны для оценки эластичности спроса – как меняется спрос при изменении цены.
- *Цены конкурентов:* на маркетплейсе могут быть аналоги товара от других продавцов. Также учитываются цены на аналогичные товары в целом по рынку (в том числе на Ozon, Яндекс.Маркете и др., если известны). Wildberries предоставляет продавцам аналитику рынка – с помощью *«умных алгоритмов можно увидеть всех, кто продает такой же продукт, и как спрос меняется в зависимости от цены»* ([Ценообразование товара на Вайлдберриз для поставщиков, торговля на Wildberries без убытка](https://moneyplace.io/wildberries/stat-wb/czenoobrazovanie-tovara-na-vajldberriz-dlya-postavshhikov/#:~:text=%D0%BF%D0%BE%D0%BB%D0%B8%D1%82%D0%B8%D0%BA%D0%B8%20%D0%BA%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D0%B5%D0%BD%D1%82%D0%BE%D0%B2,%D0%BA%D0%BE%D1%82%D0%BE%D1%80%D1%8B%D0%BC%20%D0%BA%D0%B0%D1%80%D1%82%D0%BE%D1%87%D0%BA%D0%B8%20%D0%BA%D0%BE%D0%BD%D0%BA%D1%83%D1%80%D0%B8%D1%80%D1%83%D1%8E%D1%89%D0%B5%D0%B9%20%D1%84%D0%B8%D1%80%D0%BC%D1%8B%20%D0%B2%D1%8B%D1%88%D0%B5)). Такие данные могут собираться парсингом публичной информации или через сервисы аналитики.
- *Позиция в поиске и коэффициент конверсии:* цена влияет на ранжирование (как мы видели, скидка повышает место выдачи). Поэтому алгоритм ценообразования учитывает, что снижение цены может улучшить видимость товара (больше трафика), а завышенная цена – наоборот, уронить позиции. Необходим компромисс для максимизации выручки.
- *Себестоимость и маржинальность:* минимально допустимая цена вычисляется из себестоимости товара, комиссии маркетплейса (8–25% в зависимости от категории) ([Репрайсер цен для маркетплейсов - WBPROD](https://wbprod.ru/repricer/#:~:text=%D0%A0%D0%B5%D0%BF%D1%80%D0%B0%D0%B9%D1%81%D0%B5%D1%80%20%D1%86%D0%B5%D0%BD%20%D0%B4%D0%BB%D1%8F%20%D0%BC%D0%B0%D1%80%D0%BA%D0%B5%D1%82%D0%BF%D0%BB%D0%B5%D0%B9%D1%81%D0%BE%D0%B2%20,%D1%81%D0%B5%D0%B1%D0%B5%D1%81%D1%82%D0%BE%D0%B8%D0%BC%D0%BE%D1%81%D1%82%D1%8C%2C%20%D0%BC%D0%B5%D0%BD%D1%8F%D1%8E%D1%89%D0%B8%D0%B5%D1%81%D1%8F%20%D1%86%D0%B5%D0%BD%D1%8B%20%D1%83)), логистических расходов (доставка, хранение) и целевой прибыли. Продавцу нельзя опускать цену ниже этого порога безубыточности. Эти данные (себестоимость, комиссии) обычно вводятся продавцом в своих учетных системах или в кабинете WB.
- *Сезонные и внешние факторы:* распродажи (Black Friday, 11.11, конец сезона), праздники, тренды соцсетей – все это влияет на оптимальную цену. Алгоритмы могут учитывать календарь акций Wildberries (например, заранее повышать цену, чтобы затем дать скидку необходимого размера) ([Ценообразование на Вайлдберриз для поставщиков](https://likestats.io/blog/tonkosti-tsenoobrazovaniya-na-wildberries-o-chem-nuzhno-pomnit#:~:text=%D0%92%D0%BE%D0%B7%D0%BC%D0%BE%D0%B6%D0%BD%D0%BE%D1%81%D1%82%D1%8C%20%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B8%D1%82%D1%8C%20%D0%BD%D0%B5%20%D1%82%D0%BE%D0%BB%D1%8C%D0%BA%D0%BE%20%D0%BA%D0%B0%D1%87%D0%B5%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B9,%D1%81%D0%BB%D1%83%D1%87%D0%B0%D0%B9%D0%BD%D1%8B%D1%85%20%D0%BF%D0%BE%D0%BB%D1%8C%D0%B7%D0%BE%D0%B2%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9%20%D0%B2%20%D0%BF%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%BD%D1%8B%D1%85%20%D0%BF%D0%BE%D0%BA%D1%83%D0%BF%D0%B0%D1%82%D0%B5%D0%BB%D0%B5%D0%B9)) ([Ценообразование на Вайлдберриз для поставщиков](https://likestats.io/blog/tonkosti-tsenoobrazovaniya-na-wildberries-o-chem-nuzhno-pomnit#:~:text=%D1%81%D0%BA%D0%BB%D0%B0%D0%B4%D0%B0%D1%85.%20,%D0%9F%D0%B0%D1%80%D1%82%D0%BD%D0%B5%D1%80%D0%B0%20WB%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%20%D0%B5%D1%81%D1%82%D1%8C)), а также прогнозы всплеска спроса (например, спрос на подарки перед Новым годом).

**Этапы работы алгоритма.** 
1. **Сбор информации и мониторинг:** система (или подключенный сервис репрайсинга) постоянно мониторит конкурентов и спрос. Например, раз в час собираются актуальные цены конкурентов и остатки товаров. Если конкуренты снизили цену или ввели скидку, это сразу фиксируется. Также поступают данные о продажах текущего товара: сколько продано за сегодня, не падает ли скорость продаж.
2. **Прогнозирование спроса:** на основе исторических данных ML-модель или правила пытаются предсказать, сколько будет продано при той или иной цене. Это сердцевина динамического ценообразования. **Алгоритмы анализируют данные о спросе, предложении, конкуренции и других факторах, чтобы автоматически адаптировать цены** ([Ценообразование на маркетплейсах: стратегии и вызовы](https://ecomcom.io/pricing_on_marketplaces/#:~:text=%E2%80%94%20%D0%94%D0%B8%D0%BD%D0%B0%D0%BC%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5%20%D1%86%D0%B5%D0%BD%D0%BE%D0%BE%D0%B1%D1%80%D0%B0%D0%B7%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)). Например, модель может учесть: “если снизить цену на 5%, продажи возрастут на 10%, что даст +5% к выручке” – значит снижение оправдано. Такие прогнозы могут строиться регрессионными моделями, алгоритмами машинного обучения (градиентный бустинг, нейросеть) или даже методом A/B-тестирования цены на небольших трафиковых долях.
3. **Оптимизационное правило:** задана целевая функция – чаще всего **максимизация прибыли** или **максимизация оборота при заданной марже**. Алгоритм перебирает варианты цен (с учетом ограничений себестоимости и шагов акций) и выбирает оптимальный. Например, если цель – максимальная выручка, он сравнит: продать 100 шт по 1000₽ (выручка 100k) vs 80 шт по 1200₽ (выручка 96k) vs 60 шт по 1400₽ (84k) и выберет 1000₽ как оптимум. При этом проверяется маржинальность: если цена слишком низкая и прибыль отрицательная – это исключается.
4. **Учёт акций и купонов:** алгоритм также планирует участие в акциях. Wildberries часто требует от продавца скидку ~10-30% для участия в глобальных распродажах ([Ценообразование на Вайлдберриз для поставщиков](https://likestats.io/blog/tonkosti-tsenoobrazovaniya-na-wildberries-o-chem-nuzhno-pomnit#:~:text=%D1%81%D0%BA%D0%BB%D0%B0%D0%B4%D0%B0%D1%85.%20,%D0%9F%D0%B0%D1%80%D1%82%D0%BD%D0%B5%D1%80%D0%B0%20WB%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%B9%D1%82%D0%B5%20%D0%B5%D1%81%D1%82%D1%8C)). Поэтому ценообразование может происходить в два этапа: сначала устанавливается базовая цена выше, затем на период акции дается скидка. Алгоритм рассчитывает, как скидка повлияет на ранжирование (плюс до 35% к релевантности) и на приток трафика. Например, **скидка ≥15% дает значок «горящее предложение» и вынос на главную страницу**, что резко повышает показы ([How to Start Selling on Wildberries in Russia: Registration, Taxes & Growth Hacks](https://valen-legal.com/news/open-a-company-in-russia-to-sell-on-wildberries/#:~:text=,%E2%80%9CHot%20Deals%E2%80%9D)) ([How to Start Selling on Wildberries in Russia: Registration, Taxes & Growth Hacks](https://valen-legal.com/news/open-a-company-in-russia-to-sell-on-wildberries/#:~:text=,%28ReviewTrackers)). Эти эффекты моделируются и закладываются в решение.
5. **Корректировка цены:** после вычисления оптимального значения, цена либо устанавливается автоматически (если используется автопрайсер), либо выдается рекомендация менеджеру/продавцу. Многие продвинутые продавцы используют внешние SaaS-сервисы – так называемые **репрайсеры** (Competera, Pricing Hub, Moneyplace и др.), которые через API Wildberries обновляют цены автоматически по заданным алгоритмам. Например, **инструмент Competera может раз в час менять цену** на основе данных о конкурентах ([How to Start Selling on Wildberries in Russia: Registration, Taxes & Growth Hacks](https://valen-legal.com/news/open-a-company-in-russia-to-sell-on-wildberries/#:~:text=,Warfare)). Если цена конкурента упала – ваш товар тоже снижается на 1 рубль дешевле конкурента, чтобы привлечь покупателя (но не ниже минимума). 
6. **Отслеживание результата и обучение:** после изменения цены алгоритм смотрит, как изменились продажи и позиция товара. Если продаж не прибавилось, возможно, цена все равно слишком высокая – тогда следующий цикл опустит еще. Или наоборот, товар раскупается мгновенно – значит можно было поставить дороже, алгоритм сделает вывод об эластичности спроса и в будущем попробует более высокую цену. Такой подход с постоянной корректировкой создает *замкнутый контур*: **динамическое ценообразование в режиме реального времени**, где алгоритм адаптируется к рынку.

**Метрики качества ценообразования.** Основной показатель – **выручка и прибыльность товара**. Алгоритм оценивается по тому, насколько выросла общая прибыль по сравнению со статичной ценой. Также важны:
- *Доля выигранного «корзинного блока»:* на WB один товар – одна карточка, но если товар массовый, покупатели сравнивают с конкурентами. Цель – быть наиболее привлекательным по цене/условиям среди аналогов, чтобы выбрать именно этот товар.
- *Конверсия просмотра в покупку:* отслеживается, увеличилась ли конверсия после снижения цены. Если да – значит цена стала более оптимальной.
- *Удержание позиции в рейтинге:* товар с правильно выбранной ценой будет выше в поиске (благодаря фактору скидки и конверсии). Если после изменения цены товар поднялся в выдаче и удерживает позицию – это положительный эффект.
- *Оборот и оборачиваемость склада:* динамическое ценообразование должно помогать избегать ситуаций, когда товар лежит на складе без движения. Увеличение оборачиваемости (SKU не залеживаются дольше X дней) – важный KPI, особенно для продавцов с платным хранением.
- *Удовлетворенность покупателей ценой:* косвенно меряется через отзывы («соотношение цена-качество») и NPS. Слишком высокая цена – негатив в отзывах, слишком частые скачки цены – тоже плохо (покупатели могут жаловаться, что без скидки дорого).

## Алгоритмы логистики (прогнозирование доставки и маршрутизация)

**Источники данных.** Логистические алгоритмы Wildberries охватывают два направления: **прогноз сроков доставки** для покупателей и **оптимизация самой доставки** (маршруты, распределение складских запасов). Источники данных соответственно:
- Для *прогноза сроков*: историческая статистика доставки по направлениям (от каждого склада до каждого города/ПВЗ), расписание транспортных маршрутов, данные о текущей загруженности логистической сети. Например, известно, что со склада Подмосковья до пункта выдачи в Твери посылки идут в среднем 2 дня, а до Владивостока – 8 дней. Также учитывается день недели, сезон (зимой дольше из-за погодных условий), наличие авиадоставки или только наземной.
- Для *маршрутизации и распределения*: информация о **всех заказах**, требующих доставки, их пунктах назначения, габаритах; о доступном транспорте (грузовики, их вместимость, курьерские машины, партнеры доставки вроде Почты России); о складах и остатках товара на них. Также берутся во внимание **ограничения**: дедлайны доставки (каждый заказ имеет обещанную дату доставки клиенту), **стоимость перевозки** по различным маршрутам, тарифы партнеров, пропускная способность складов и сортировочных центров (сколько отправлений они могут обработать в день).

**Этапы работы алгоритмов.** 
1. **Прогнозирование времени доставки (ETA):** Когда пользователь просматривает товар, система вычисляет примерный срок доставки «доставим за X дней». Этот ETA (estimated time of arrival) рассчитывается алгоритмом на основе ближайшего места нахождения товара и местоположения клиента. Wildberries определяет, на каком складе сейчас товар в наличии, и какой маршрут до выбранного пункта выдачи. *Алгоритм ETA* может быть реализован как ML-модель (обученной на прошлых доставках) или как детерминированное правило с поправками. Например, модель регрессии может учитывать: расстояние в километрах, среднюю скорость доставки на этом плече, текущую нагрузку в регионе (если период распродаж – добавить 1-2 дня задержки). Используя большие данные о прошлых доставках, модель предскажет с некоторой вероятностью доставку за N дней с точностью до 90%. Система подстраивается: если видит, что часто не укладывается в обещанные сроки на конкретном направлении, ETA автоматически увеличивается. Основная цель – **точность**: чтобы покупатель почти всегда получал заказ не позднее обещанной даты. На стороне пользователя это выглядит просто: в карточке товара написано, например, «Получение – послезавтра, 12 апреля», и в большинстве случаев так и происходит.
2. **Оптимизация распределения товаров по складам:** Еще *до* того, как товар заказан, возникает задача логистики – куда разместить товар в сети складов. Wildberries имеет десятки складов и сортировочных центров по стране. **Алгоритм прогнозирования спроса по регионам** помогает рекомендовать поставщикам, сколько товара завезти на каждый склад ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=%D0%90%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%BC%D0%BE%D0%BC%20%D0%B4%D0%B5%D0%BB%D0%B5%2C%20%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F,%D0%AD%D1%82%D0%BE%20%D0%BF%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D0%BE)). Команда Data Science анализирует историю заказов по географии: например, товар “термос” чаще заказывают в холодных регионах, а “пляжная одежда” – на юге. С помощью моделей прогнозируется, из каких городов/регионов ожидается спрос на конкретный товар в ближайшее время. Затем решается **задача распределения**: как разделить партию товаров по складам, чтобы суммарные логистические затраты были минимальны, а покупатели получили товар быстро. Это можно сформулировать как оптимизационную задачу (близкую к задаче о максимальном покрытии спроса). Алгоритм учитывает емкость каждого склада, стоимость хранения, стоимость межскладского перемещения. Результат – рекомендация: например, *30% товара отправить на склад Подмосковья, 20% – в Екатеринбург, 50% – в Новосибирск*, потому что ожидается много заказов из Сибири, и лучше заранее там иметь запас ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=%D0%90%20%D0%BD%D0%B0%20%D1%81%D0%B0%D0%BC%D0%BE%D0%BC%20%D0%B4%D0%B5%D0%BB%D0%B5%2C%20%D0%BE%D0%BF%D1%82%D0%B8%D0%BC%D0%B8%D0%B7%D0%B0%D1%86%D0%B8%D1%8F,%D0%AD%D1%82%D0%BE%20%D0%BF%D0%BE%D0%BB%D0%B5%D0%B7%D0%BD%D0%BE)). Эта рекомендация доводится до продавца в личном кабинете или автоматически применяется, если товар продается по FBO-модели. Правильное распределение снижает последующую **длину доставки** (товар уже ближе к потребителю) и улучшает фактор ранжирования “время доставки” ([
        Выдача и ранжирование товаров на Wildberries в 2024 году
      ](https://sellermoon.ru/faq/wildberries/poiskovaya-sistema-wb#:~:text=%D0%92%D0%BB%D0%B8%D1%8F%D0%BD%D0%B8%D0%B5%3A%20%D0%BE%D1%82%2030%20%D0%B4%D0%BE%2040)), что выгодно всем сторонам.
3. **Планирование отгрузки и маршрутов:** Как только заказ оформлен, наступает этап доставки. Wildberries самостоятельно определяет маршруты перевозки товара ([13. Правила оказания услуг - Wildberries](https://seller.wildberries.ru/instructions/en/ru/material/A-191#:~:text=13.%20%D0%9F%D1%80%D0%B0%D0%B2%D0%B8%D0%BB%D0%B0%20%D0%BE%D0%BA%D0%B0%D0%B7%D0%B0%D0%BD%D0%B8%D1%8F%20%D1%83%D1%81%D0%BB%D1%83%D0%B3%20,%D0%BA%20%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B7%D0%BA%D0%B5%20%D0%A2%D0%BE%D0%B2%D0%B0%D1%80%D0%B0%20%D1%82%D1%80%D0%B5%D1%82%D1%8C%D0%B8%D1%85%20%D0%BB%D0%B8%D1%86)). Если товар находится на одном складе, а покупатель – в другом городе, происходит перемещение: либо напрямую до ближайшего пункта выдачи, либо через промежуточные сортировочные центры. Алгоритм решает: каким транспортом и по какому маршруту послать посылку, чтобы она пришла в срок и дешево. Это классическая задача маршрутизации в логистике. В Wildberries она осложнена масштабом – тысячи точек доставки (ПВЗ) и сотни тысяч заказов в день. Задача дробится: сперва грузы доставляются от складов до региональных распределительных центров, там сортируются по направлениям, затем везутся на конечные точки. Для **оптимизации маршрутов** используются алгоритмы решения задач коммивояжера и VRP (Vehicle Routing Problem). В научной работе, проведенной на примере Wildberries, отмечено, что задачу построения оптимального маршрута для развозки можно рассматривать как задачу коммивояжера и решать специальными методами ([ПОИСК ОПТИМАЛЬНОГО МАРШРУТА ДОСТАВОК НА ПРИМЕРЕ КОМПАНИИ ООО "ВАЙЛДБЕРРИЗ" – тема научной статьи по экономике и бизнесу читайте бесплатно текст научно-исследовательской работы в электронной библиотеке КиберЛенинка](https://cyberleninka.ru/article/n/poisk-optimalnogo-marshruta-dostavok-na-primere-kompanii-ooo-vayldberriz#:~:text=%D0%92%20%D0%B4%D0%B0%D0%BD%D0%BD%D0%BE%D0%B9%20%D1%81%D1%82%D0%B0%D1%82%D1%8C%D0%B5%20%D0%B1%D1%83%D0%B4%D0%B5%D1%82%3A%20%C2%B7,the%20method%20and%20tool%20for)). На практике применяются эвристики: например, алгоритм кластеризации точек доставки по географическому принципу, а затем построение оптимального пути внутри кластера (алгоритм ближайшего соседа, метод ветвей и границ, или более современные методы с использованием солверов вроде Google OR-Tools). Wildberries стремится минимизировать пробег транспорта при выполнении всех доставок. Также важно учесть **вместимость**: алгоритм группирует заказы по машинам, не превышая грузоподъемность. Если какие-то маршруты нерентабельны (мало посылок в отдаленный населенный пункт), их могут передать партнеру (например, Почте) или отложить до накопления достаточного объема – тут тоже решение принимает алгоритм, оценивая, что дешевле.
4. **Динамическая перенастройка и отслеживание:** Логистическая система работает в реальном времени: если где-то случился сбой (машина сломалась, склад перегружен), алгоритмы должны перераспределить потоки. Например, если увеличилась нагрузка на московский склад, новые заказы временно перенаправят через соседний центр. Существует контролирующая метрика – процент заказов, отправленных с задержкой. Wildberries доказал, что *задержка доставки в разы увеличивает вероятность отказа от выкупа* ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=%D0%AD%D1%82%D0%BE%20%D0%B4%D0%BE%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%20%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%B0%D1%8F%20%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B0%3A%20%D0%BD%D1%83%D0%B6%D0%BD%D0%BE,%D1%81%D0%BA%D0%BB%D0%B0%D0%B4%D0%BE%D0%B2%2C%20%D1%82%D1%80%D0%B0%D0%BD%D1%81%D0%BF%D0%BE%D1%80%D1%82%D0%B0%20%D0%B8%20%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%B5%20%D0%B0%D1%81%D0%BF%D0%B5%D0%BA%D1%82%D1%8B)), т.е. клиент просто не заберет товар, и его придется везти обратно (убытки на возврат). Поэтому алгоритмы жестко следят за дедлайнами: лучше отправить быстрее пусть и с чуть большими расходами, чем допустить просрочку. В этом плане, если прогноз показывает, что обычным путем не успеть, система может экстренно задействовать резерв – например, отправить самолетом или курьерской службой, чтобы уложиться в обещанные сроки. Все эти решения принимаются на основе правил и моделей, настроенных на минимизацию совокупных логистических затрат *при соблюдении сроков* ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=%D0%AD%D1%82%D0%BE%20%D0%B4%D0%BE%D0%B2%D0%BE%D0%BB%D1%8C%D0%BD%D0%BE%20%D1%81%D0%BB%D0%BE%D0%B6%D0%BD%D0%B0%D1%8F%20%D0%B7%D0%B0%D0%B4%D0%B0%D1%87%D0%B0%3A%20%D0%BD%D1%83%D0%B6%D0%BD%D0%BE,%D1%81%D0%BA%D0%BB%D0%B0%D0%B4%D0%BE%D0%B2%2C%20%D1%82%D1%80%D0%B0%D0%BD%D1%81%D0%BF%D0%BE%D1%80%D1%82%D0%B0%20%D0%B8%20%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%B5%20%D0%B0%D1%81%D0%BF%D0%B5%D0%BA%D1%82%D1%8B)).
5. **Обучение и улучшение:** Логистические алгоритмы регулярно пересматриваются. После каждой крупной акции анализируются узкие места: где скапливались задержки, какие маршруты были перегружены. Аналитики и DS-специалисты используют эти данные, чтобы скорректировать модели. Например, могут обновить прогнозные времена доставки для некоторых регионов, если заметили систематическую ошибку. Или улучшить алгоритм кластеризации маршрутов, если видят, что машины ездят полупустыми. Wildberries проводит системный анализ логистики: любые отклонения (перерасход топлива, превышение сроков) – сигнал для улучшения алгоритма.

**Метрики качества логистики.** Главная метрика – **доля заказов, доставленных вовремя** (или среднее отклонение от обещанного срока). Wildberries старается держать высокий процент (например, 95%+ в срок). Другие показатели:
- *Средний срок доставки* по стране и по регионам. Сокращение этого срока – ключевое конкурентное преимущество. Wildberries известен тем, что ~95% заказов доставляются в пределах 24 часов по своим основным регионам ([How to Start Selling on Wildberries in Russia: Registration, Taxes & Growth Hacks](https://valen-legal.com/news/open-a-company-in-russia-to-sell-on-wildberries/#:~:text=Wildberries%E2%80%99%20dominance%20stems%20from%20its,Data%20Insight%2C%202024)), благодаря оптимизированной логистике.
- *Стоимость доставки на единицу (на заказ).* Это сумма из затрат на перевозку, упаковку, хранение. Алгоритмы оптимизируют этот показатель. Каждый лишний километр маршрута или лишний день хранения – увеличение стоимости.
- *Загруженность/вместимость.* Смотрят, насколько эффективно используются машины (процент заполнения), насколько равномерно загружены склады. Например, если один склад забит, а другой пустует – это неэффективно, и алгоритмы перераспределения должны это решать.
- *Процент отказов (невыкупов) по причине задержки.* Если алгоритмы работают правильно, эта метрика должна быть минимальной. Рост невыкупов сигнализирует о проблемах в исполнении сроков.
- *Скорость обратной логистики (возвраты).* Тоже важный аспект: оптимальные маршруты нужны не только “туда”, но и “обратно”. Метрики отслеживают, чтобы возвраты с ПВЗ на склад шли наиболее коротким путем, минимизируя издержки.



## Алгоритмы персонализации выдачи товаров в каталоге

**Источники данных.** Персонализация каталога означает, что разные пользователи могут видеть разные порядок товаров на одной и той же странице (будь то главная страница, страница категории или даже результаты поиска). Для такой персонализации используются:
- *История взаимодействий пользователя:* поисковые запросы, клики по товарам, просмотры категорий, покупки. Это позволяет понять интересы пользователя. Например, пользователь часто ищет спортивные товары и просматривает бренд Nike – значит, ему интересен спорт и конкретно этот бренд.
- *Демографические данные пользователя:* пол, возраст, местоположение. Эти данные помогают агрегировать предпочтения. Например, женщины чаще покупают платья, мужчины – электронику, молодежь – модные гаджеты, и т.д. Зная профиль, можно отфильтровать несоответствующие товары (мужчине – не показывать косметику для женщин и наоборот).
- *Время, сезон, контекст:* предпочтения могут зависеть от времени. Поутру люди чаще просматривают еду и кофе, в выходные – товары для дома. Перед праздниками – подарки. Алгоритм персонализации может учитывать текущую дату и популярные тематики этого дня/периода.
- *Общий рейтинг и свежесть товаров:* хотя персонализация индивидуальна, она опирается и на глобальные данные – какие товары вообще популярны сейчас, новинки и тренды. Полностью исключать популярные товары нельзя, ведь они могут быть интересны многим. Поэтому данные о глобальных бестселлерах, трендах соцсетей, распродажах тоже поступают в систему – персонализация их либо включает, либо нет в индивидуальную выдачу в зависимости от уместности для данного пользователя.

**Этапы работы алгоритма.**
1. **Сегментация пользователя:** на основе собранных данных пользователь может быть отнесен к определенным сегментам или кластерам. Например, алгоритм может определить, что пользователь A – «молодая мама, интересуется детскими товарами и бюджетной одеждой», а пользователь B – «мужчина-геймер, интересуется электроникой премиум-класса». Эта сегментация может выполняться алгоритмами кластеризации или правил. Также может быть продолжением профиля рекомендаций (см. персональные рекомендации выше). В Wildberries появление персонализации заметили, когда разные пользователи стали получать разный порядок товаров, основанный на их поведении (что искал ранее, что смотрел, что покупал).
2. **Адаптация ранжирования под пользователя:** когда пользователь заходит, скажем, в категорию «кроссовки», система формирует базовый список товаров (как если бы без персонализации – по общей популярности). Далее алгоритм перестраивает порядок с учетом предпочтений пользователя. Например, если пользователь прежде чаще покупал бренд Adidas, то в разделе «кроссовки» для него модели Adidas будут подняты выше, чем для другого пользователя, у которого в приоритете Nike. Если это поиск, то персонализатор может повысить в ранге товары той категории, которой пользователь интересуется. По сути, персонализация – это дополнительный *коэффициент релевантности*, зависящий от пользователя. Он умножается на исходный скор товара. В результате выдача “поворачивается” в сторону интересов конкретного человека. Wildberries тестирует такую систему: например, начало учитывать **ранее просмотренные карточки, покупки конкретного пользователя** при сортировке результатов . Также могут влиять агрегированные признаки: пол (женщине при прочих равных чуть выше покажут женские модели товара), география (в холодном регионе выше ранжируются теплые вещи – хотя это и под общую популярность попадает, но персональный профиль тоже знает регион).
3. **Персонализация витрины и рекомендаций:** помимо поисковой выдачи и каталога, персонализация проявляется на главной странице и в специальных подборках. Например, раздел «Рекомендуемое для вас» на главной странице формируется полностью на основе предпочтений – это аналог ленты рекомендаций, обсужденной ранее . В каталоге же (например, открыл пользователь раздел «Телефоны») – могут подмешиваться персональные рекомендации внутри обычного списка. Wildberries могла реализовать это как гибрид: часть товаров – общие хиты категории, а часть – специфические товары, интересные этому пользователю (например, редкий бренд, которым он интересовался раньше, но не очень популярный глобально). Таким образом, каждый пользователь видит слегка разную подборку. В новости от 2023 года отмечалось, что Wildberries внедряет **персонализированную выдачу в поиске**, основанную на предпочтениях конкретного покупателя (его прошлых запросах, посещенных карточках, покупках) . Можно предположить, что и каталожная сортировка “по популярности” становится персонализированной – фактически, *«популярность для данного пользователя»*.
4. **Ограничения и проверка баланса:** Персонализация не должна ухудшать опыт для нового пользователя (о котором ничего не известно) или загонять человека в информационный пузырь только его прошлых интересов. Поэтому алгоритмы содержат «бэк-офф»: часть выдачи остается неперсонализированной или слабо персонализированной, особенно если уверенности мало. Например, первые 2-3 позиции могут быть общими хиты (для всех), а начиная с 4-й – уже персональный микс. Или наоборот, первые позиции – персональные, а дальше – общие, это можно тестировать. Wildberries, вероятно, проводит A/B эксперименты, чтобы найти баланс. Задача аналитиков – **не перегнуть палку**: нужно, чтобы каждая аудитория была довольна, и новому пользователю тоже что-то показывалось осмысленное ([В каких командах и проектах Wildberries есть задачи для аналитиков / Хабр](https://habr.com/ru/companies/wildberries/articles/886064/#:~:text=%D0%A2%D0%B0%D0%BA%D0%B6%D0%B5%20%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9%20%D0%B8%D0%B7%20%D0%B2%D0%B0%D0%B6%D0%BD%D1%8B%D1%85%20%D1%84%D0%B8%D1%87%D0%B5%D0%B9,%D1%81%D0%B2%D0%BE%D0%B8%D0%BC%20%D0%BE%D0%BF%D1%8B%D1%82%D0%BE%D0%BC%20%D0%B2%D0%B7%D0%B0%D0%B8%D0%BC%D0%BE%D0%B4%D0%B5%D0%B9%D1%81%D1%82%D0%B2%D0%B8%D1%8F%20%D1%81%20%D0%BF%D0%BB%D0%B0%D1%82%D1%84%D0%BE%D1%80%D0%BC%D0%BE%D0%B9)). Кроме того, компания учитывает, что персонализация затрудняет продавцам отслеживание своих позиций (порядок товаров становится разным у разных людей). Поэтому, возможно, полная персонализация вводится постепенно и не на всех страницах (например, может затрагивать только некоторую часть сортировки “по популярности”, а явные сортировки “по цене” или “по отзывам” остаются одинаковыми для всех).
5. **Обучение и улучшение:** Персонализационные алгоритмы обучаются по тому, как меняется поведение пользователей. Если после внедрения персонализированной выдачи пользователи стали быстрее находить нужное и реже делать пустые поиски – значит алгоритм работает. В противном случае параметры модели пересматриваются. Обучение тут схоже с рекоммендерами: используют implicit-фидбек (клики, покупки) для тренировки моделей, предсказывающих интерес пользователя к товару. Возможно, применяются модели типа factorization machines или нейросети, которые на вход берут признаки пользователя и товара и выдают скор “насколько вероятно, что пользователь кликнет/купит”. Затем эти модели интегрируются в ранжирование.

**Метрики персонализации.** Нужно убедиться, что персонализированная выдача **лучше** для пользователя, чем обобщенная. Метрики:
- *CTR и конверсия.* Если персонализация успешна, пользователь кликает на результаты чаще (они ему более релевантны) и покупает больше. Анализ проводится по группам: тестовая группа с персонализацией vs контрольная без – сравнивается разница в CTR, в revenue per user, количестве позиций просмотра до покупки.
- *Время до нахождения нужного товара.* Предполагается, что персонализация сократит время, так как нужное окажется выше. Это измеряется как средняя позиция товара, который в итоге купил пользователь по запросу/категории.
- *Разнообразие покупок.* Есть риск, что персонализация будет слишком узко показывать привычное, и пользователь не увидит что-то новое. Поэтому меряется, не снизилось ли число уникальных категорий/брендов, просматриваемых пользователем. Если снизилось – возможно, алгоритм слишком его “закрыл” в старых интересах.
- *Вовлеченность и возвраты.* Улучшилась ли вовлеченность: например, вырос ли средний чек или число товаров в корзине (может, персонализация подняла дополняющие товары). А возвраты (отказы) не выросли ли – важно не навязывать пользователю не то. 
- *Метрики продавцов.* Wildberries также учитывает фидбек от продавцов: если персонализация слишком бьет по видимости каких-то товаров, это может быть проблемой. В новости отмечалось, что внешние аналитические сервисы перестанут правильно показывать позиции товаров, и Wildberries может монетизировать доступ к “настоящей” (персонализированной) выдаче. То есть контроль за метриками прозрачности тоже имеет место.


## 8. Технологии

| **Технология** | **Область применения** | **Мотивация** |
|----------------|-------------------------|----------------|
| **Golang** | Основной язык серверного **backend**-разработки. Используется для высоконагруженных веб-сервисов и API. | Высокая производительность, эффективная параллельность (goroutines), минимальное потребление памяти. Широкая экосистема и поддержка микросервисной архитектуры. |
| **Rust** | Язык для высокопроизводительных системных сервисов. | Гарантия безопасности памяти, высокая скорость исполнения, современный язык с растущим сообществом. |
| **React (TypeScript)** | **Frontend** веб-интерфейсов маркетплейса. | Компонентный подход, высокая скорость UI, типизация TypeScript повышает надежность и масштабируемость. |
| **Angular (TypeScript)** | **Frontend** для сложных веб-приложений (админки, кабинеты). | Строгая архитектура, двухсторонняя привязка данных, поддержка TypeScript, подходит для крупных проектов. |
| **Vue.js** | **Frontend** модулей и легких интерфейсов. | Простота вхождения, реактивность, гибкость интеграции в существующие проекты. |
| **PostgreSQL** | Реляционная **БД** для хранения заказов, аккаунтов и каталога. | ACID, мощные запросы, open-source, широкое сообщество, поддержка масштабирования. |
| **Tarantool** | In-memory NoSQL-хранилище и сервер приложений. | Высокая скорость доступа, масштабируемость, отказоустойчивость, персистентность, замена MS SQL. |
| **Redis** | In-memory кеш и pub/sub механизм. | Мгновенные операции, поддержка структур, низкая задержка, масштабируемость. |
| **ClickHouse** | Колонковая аналитическая СУБД (OLAP-нагрузки). | Быстрые агрегации, горизонтальное масштабирование, сжатие данных, open-source. |
| **Vertica** | Enterprise BI-аналитика и отчётность. | Надежность, высокая производительность на аналитике, масштабируемость. |
| **Elasticsearch / OpenSearch** | Полнотекстовый поиск и логирование. | Быстрый поиск, сложное ранжирование, open-source альтернатива, масштабируемость. |
| **Apache Kafka** | Стриминг данных и event-driven архитектура. | Высокая пропускная способность, отказоустойчивость, асинхронное взаимодействие сервисов. |
| **NATS** | Real-time message-broker. | Минимальные задержки, легкость настройки, масштабируемость. |
| **Nginx** | Web-сервер и балансировщик. | Высокая производительность, гибкость, статическое кеширование, маршрутизация. |
| **HAProxy** | Балансировка TCP/HTTP. | Простота конфигурации, высокая скорость, отказоустойчивость. |
| **Kubernetes** | Оркестрация контейнеров. | Автоматизация масштабирования и отказоустойчивости, поддержка микросервисов, гибкость. |
| **Docker** | Контейнеризация backend-приложений. | Изоляция среды, упрощение деплоя, стандарт индустрии, интеграция с CI/CD. |
| **GitLab CI/CD** | Автоматизация сборки и доставки. | Быстрая доставка изменений, снижение ошибок, интеграция с Git, масштабируемость. |
| **Prometheus** | Мониторинг метрик. | Эффективное хранение временных рядов, PromQL, интеграция с Kubernetes. |
| **Grafana** | Визуализация мониторинга. | Гибкие дашборды, поддержка разных источников данных, удобство мониторинга. |
| **OpenSearch (ELK)** | Централизованное логирование. | Поиск по логам, визуализация, open-source, отказоустойчивость. |
| **Apache Hadoop & Spark** | Batch-аналитика и обработка Big Data. | Обработка больших данных, горизонтальное масштабирование, богатая экосистема. |
| **TensorFlow & PyTorch** | ML и компьютерное зрение. | Построение нейросетей, работа с GPU, перенос новейших моделей в продакшн. |

---

## 9. Обеспечение надёжности

| **Компонент системы** | **Способ резервирования** | **Иные механизмы** | **Пояснение** |
|-----------------------|----------------------------|--------------------|---------------|
| **Балансировщики нагрузки (LVS, Nginx, HAProxy)** | Active-Passive (L4) + Active-Active (L7) | Keepalived, health-checks, stateless конфигурации | На L4 — один активный, другой резерв (VRRP). На L7 — несколько экземпляров работают одновременно (stateless), сбой одного не влияет на доступность. |
| **Kubernetes** | Мастер-ноды в HA-кластере | Liveness/Readiness Probes, автохилинг, HPA | При сбое подов — перезапуск, при падении ноды — перенос workload. Автомасштабирование и восстановление через ReplicaSets. |
| **API Gateway** | Active-Active (кластер) | Rate limiting, fallback-ответы | Stateless-инстансы масштабируются горизонтально, при сбое запросы перенаправляются без потери состояния. |
| **PostgreSQL** | Master-Standby (репликация) | WAL, Patroni, PgBouncer | Replication и автоматический failover. Данные синхронизированы между репликами. PITR и регулярные бэкапы. |
| **Tarantool** | Master-Master с шардингом | Circuit Breaker, логика маршрутизации в клиенте | 2 узла на шарде (в разных ЦОД), приложение управляет обращениями. Переключение при сбое — прозрачно. |
| **Redis** | Master-Slave (Sentinel) | RDB/AOF снапшоты | Используется только для кешей и временных данных. При сбое восстанавливается из backend или снапшотов. |
| **ClickHouse** | Репликация + шардирование | ReplicatedMergeTree, Keeper | Шарды + несколько реплик. Запросы обрабатываются параллельно. При сбое — failover на реплику. |
| **Apache Kafka** | Кластер (репликация разделов) | acks=all, ISR, MirrorMaker | Данные пишутся на несколько брокеров. Автоматическое переключение лидерства, высокая устойчивость. |
| **NATS** | Кластер серверов | JetStream, авто-переключение клиентов | При сбое ноды клиенты переподключаются к другой. Возможна репликация сообщений при включённом JetStream. |
| **S3-совместимое хранилище** | 3-кратная репликация | Версионирование, cross-zone replication | Данные дублируются на несколько узлов/зон. При сбое сервера/зоны доступность сохраняется. |
| **HDFS** | 3 DataNode-копии | NameNode HA, ZKFC | Каждый блок файла хранится в 3 местах. Active-Standby NameNode переключается автоматически при сбое. |
| **CDN** | Геораспределённый Active-Active | Anycast, fallback на origin | Пользователь подключается к ближайшему узлу. При сбое — автоматическая маршрутизация на другой или к origin. |
| **Prometheus + Grafana** | Federation, резервные инстансы | Remote write, backup дашбордов | Дублирование метрик, визуализация восстанавливается из конфигураций. |
| **OpenSearch (логирование)** | Кластер с репликами | Snapshot индексов, redundancy | Шарды и реплики данных, при сбое узла — чтение продолжается с других. |

---


## Список источников

1. [Wildberries — ruwiki](https://ru.ruwiki.ru/wiki/Wildberries)  
2. [SimilarWeb: Wildberries (overview)](https://www.similarweb.com/ru/website/wildberries.ru/#overview)  
3. [CMP Wildberries (Special project kit) — аудитория, статистика](https://cmp.wildberries.ru/cmpf/Special%20project%20kit%20WB.pdf)  
4. [Retail.ru: Оборот Wildberries, 14 млн посетителей в день](https://www.retail.ru/news/oborot-wildberries-vyros-na-101-v-iii-kvartale-15-oktyabrya-2021-210183/)  
5. [Data Insight — Sellers Monitoring 2024 (40 млн SKU)](https://datainsight.ru/sites/default/files/DI_Sellers_monitoring_2024_1_0.pdf?ysclid=m7px4bgk8r609130117)  
6. [Plusworld: Средняя цена и средний чек на маркетплейсах](https://plusworld.ru/articles/62655/#:~:text=%D0%A1%D1%80%D0%B5%D0%B4%D0%BD%D1%8F%D1%8F%20%D1%86%D0%B5%D0%BD%D0%B0%20%D0%BD%D0%B0%20%D0%BC%D0%B0%D1%80%D0%BA%D0%B5%D1%82%D0%BF%D0%BB%D0%B5%D0%B9%D1%81%D0%B5)  
7. [Mertech.ru: 8,8 млн заказов Wildberries в сутки](https://mertech.ru/blog/marketpleisy/kak-otkryt-punkt-vydachi-zakazov-wildberries-v-2024/#:~:text=Wildberries%20%E2%80%94%20%D1%81%D0%B0%D0%BC%D1%8B%D0%B9%20%D1%80%D0%BE%D1%81%D1%81%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9)  
8. [HTTP Archive: Статистика «веса» страницы](https://httparchive.org/reports/page-weight)  
9. [Workspace.ru](https://workspace.ru/blog/algoritmy-ranzhirovaniya-na-wildberries-kak-oni-rabotayut-i-kak-uluchshit-vidimost-svoih-tovarov/)
10. https://www.cloudflare.com/learning/performance/why-site-speed-matters/

(https://habr.com/ru/articles/598961/#:~:text=%D0%92%D1%81%D0%B5%D0%BC%20%D0%BF%D1%80%D0%B8%D0%B2%D0%B5%D1%82%2C%20%D1%8F%20%E2%80%94%20%D0%A1%D0%B5%D1%80%D0%B3%D0%B5%D0%B9,%D0%91%D0%BE%D0%B1%D1%80%D0%B5%D1%86%D0%BE%D0%B2%2C%20CTO%20%D0%B2%20Wildberries)) ([Вызовы цифровой трансформации, с которыми справляется Tarantool](https://www.tarantool.io/blog/ru/digitaltransformation/#:~:text=%D0%A0%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D0%B5,%D0%BD%D0%B0%20Tarantool%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D1%8E%D1%82%2012%20%D0%BC%D0%B8%D0%BA%D1%80%D0%BE%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)), официальных материалов (например, [Wildberries Tech](https://wbtech.wildberries.ru) и выступлений WB Day) и описаний вакансий Wildberries ([Вакансия Senior Golang Developer (Автоматизация с применением ИИ), в компании WILDBERRIES](https://dreamjob.ru/employers/6690/vakansii/119115567#:~:text=%D0%A1%D1%82%D0%B5%D0%BA%3A%20Go%2C%20Postgres%2C%20Clickhouse%2C%20Kafka%2C,Nats%2C%20Redis)) ([Вакансия Senior DevOps Engineer [Sender], в компании WILDBERRIES](https://dreamjob.ru/employers/6690/vakansii/119339877#:~:text=%D0%B8%20%D1%81%D0%B2%D1%8F%D0%B7%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D1%81%20%D0%BD%D0%B5%D0%B9%20%D1%81%D0%B5%D1%80%D0%B2%D0%B8%D1%81%D0%BE%D0%B2)), которые раскрывают используемый стек технологий.
